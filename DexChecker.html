<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pok√©mon GO Collection Viewer</title>
    <style>
        :root {
            --primary-color: #e53935;
            --secondary-color: #2196f3;
            --accent-color: #ffc107;
            --dark-color: #333;
            --light-color: #f5f5f5;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --card-bg: white;
            --text-color: #333;
            --muted-text: #777;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 85%;
            margin: 0 auto;
            padding: 20px;
            background-color: var(--light-color);
            color: var(--text-color);
            line-height: 1.6;
        }
        
        h1, h2, h3 {
            color: var(--primary-color);
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .controls {
            background-color: var(--card-bg);
            border-radius: 10px;
            box-shadow: 0 3px 10px var(--shadow-color);
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .control-section {
            margin-bottom: 15px;
        }
        
        .control-section:last-child {
            margin-bottom: 0;
        }
        
        .control-section h3 {
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .filters-row {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }
        
        .filters-row:last-child {
            margin-bottom: 0;
        }
        
        select, input, button {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: white;
            font-size: 14px;
        }
        
        select, input {
            min-width: 150px;
        }
        
        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
            min-width: auto;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        button:hover {
            background-color: #c62828;
        }
        
        button.secondary {
            background-color: var(--secondary-color);
        }
        
        button.secondary:hover {
            background-color: #1976d2;
        }
        
        button.accent {
            background-color: var(--accent-color);
            color: var(--dark-color);
        }
        
        button.accent:hover {
            background-color: #ffb300;
        }
        
        .stats-container {
            background-color: var(--card-bg);
            border-radius: 10px;
            box-shadow: 0 3px 10px var(--shadow-color);
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .stat-box {
            flex: 1;
            min-width: 150px;
            text-align: center;
            padding: 15px;
            background-color: #f5f5f5;
            border-radius: 8px;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .stat-label {
            font-size: 14px;
            color: var(--muted-text);
        }
        
        .selection-tools {
            background-color: var(--card-bg);
            border-radius: 10px;
            box-shadow: 0 3px 10px var(--shadow-color);
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .selection-tools h3 {
            margin-bottom: 10px;
        }
        
        .search-string {
            padding: 10px;
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 10px 0;
            word-break: break-all;
            font-family: monospace;
        }
        
        .pokemon-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
        }
        
        .pokemon-card {
            background-color: var(--card-bg);
            border-radius: 10px;
            box-shadow: 0 3px 10px var(--shadow-color);
            padding: 15px;
            text-align: center;
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
            cursor: pointer;
        }
        
        .pokemon-card:hover {
            transform: translateY(-12px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .pokemon-card.selected {
            border: 3px solid var(--primary-color);
            padding: 12px;
        }
        
        .pokemon-card.shiny {
            background: linear-gradient(135deg, #000 0%, #ffd700 50%, #ffd700 100%);
        }
        
        .pokemon-card.shadow {
            background: linear-gradient(135deg, #fff 0%, #fff 70%, #e0e0e0 100%);
        }
        
        .pokemon-card.lucky {
            background: linear-gradient(135deg, #fff 0%, #fff 70%, #fff9c4 100%);
        }
        
        .badge {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 12px;
            padding: 3px 6px;
            border-radius: 4px;
            color: white;
        }
        
        .lucky-badge {
            background-color: #ffc107;
            color: #333;
        }
        
        .sprite-container {
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 10px;
        }
        
        .sprite {
            max-height: 140px;
            max-width: 140px;
        }
        
        .pokemon-name {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 5px;
            color: var(--dark-color);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .pokemon-number {
            color: var(--muted-text);
            font-weight: bold;
			font-size: 14px;
            margin-bottom: 10px;
        }
        
        .pokemon-cp {
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 5px;
            color: var(--primary-color);
        }
        
        .stats {
            display: flex;
            justify-content: space-around;
            margin-top: 10px;
        }
        
        .stat {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .stat-value {
            font-weight: bold;
            color: var(--dark-color);
        }
        
        .stat-label {
            font-size: 10px;
            color: var(--muted-text);
        }
        
        .gender-male {
            color: #2196f3;
        }
        
        .gender-female {
            color: #e91e63;
        }
        
        .gender-neutral {
            color: #9e9e9e;
        }
        
        .move {
            font-size: 11px;
            color: #555;
            margin-top: 10px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .hidden {
            display: none !important;
        }
        
        /* Modal styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 10px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            display: flex;
            flex-direction: column;
        }
        
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #eee;
            position: sticky;
            top: 0;
            background-color: white;
            z-index: 10;
            border-radius: 10px 10px 0 0;
        }
        
        .modal-body {
            padding: 20px;
            overflow-y: auto;
        }
        
        .modal-footer {
            padding: 20px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: flex-end;
            position: sticky;
            bottom: 0;
            background-color: white;
            border-radius: 0 0 10px 10px;
        }
        
        .close-modal {
            position: absolute;
            right: 20px;
            top: 20px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #777;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .close-modal:hover {
            color: var(--primary-color);
        }
        
        .modal-details {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .detail-pokemon-sprite {
            text-align: center;
            flex: 1;
            min-width: 200px;
        }
        
        .detail-pokemon-sprite img {
            max-width: 200px;
            max-height: 200px;
        }
        
        .detail-pokemon-info {
            flex: 2;
            min-width: 300px;
        }
        
        .detail-section {
            margin-bottom: 20px;
        }
        
        .detail-section h3 {
            margin-bottom: 10px;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        
        .detail-stats {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .detail-stat-box {
            background-color: #f5f5f5;
            border-radius: 8px;
            padding: 10px;
            min-width: 80px;
            text-align: center;
        }
        
        .detail-moves {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .detail-move {
            background-color: #f5f5f5;
            border-radius: 8px;
            padding: 10px;
            min-width: 120px;
        }
        
        .detail-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .detail-table tr {
            border-bottom: 1px solid #eee;
        }
        
        .detail-table th, .detail-table td {
            padding: 8px;
            text-align: left;
        }
        
        .detail-table th {
            color: var(--muted-text);
            font-weight: normal;
            width: 40%;
        }
        
        .detail-table td {
            font-weight: 500;
        }
        
        .stat-bar-container {
            width: 100%;
            height: 6px;
            background-color: #eee;
            border-radius: 3px;
            margin-top: 5px;
        }
        
        .stat-bar {
            height: 100%;
            border-radius: 3px;
        }
        
        .stat-bar-attack {
            background-color: #ff5252;
        }
        
        .stat-bar-defence {
            background-color: #2196f3;
        }
        
        .stat-bar-stamina {
            background-color: #4caf50;
        }
        
        .progress-bar {
            border-radius: 5px;
            overflow: hidden;
            margin-top: 5px;
            background-color: #e0e0e0;
            height: 8px;
        }
        
        .progress-fill {
            height: 100%;
            background-color: var(--primary-color);
        }
        
        /* Responsive */
        @media (max-width: 600px) {
            .pokemon-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
            
            .stat-box {
                min-width: 100%;
            }
            
            .modal-content {
                width: 95%;
            }
        }
        
        /* Toggle switch */
        .toggle-container {
            display: flex;
            align-items: center;
        }
        
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
            margin-right: 10px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: var(--primary-color);
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        
        .toggle-label {
            font-size: 14px;
        }
        
        /* Loading spinner */
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: var(--primary-color);
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
        
        .load-more-container {
            text-align: center;
            margin-top: 20px;
        }
		.alpha-nav {
			position: fixed;
			top: 50%;
			right: 10px;
			transform: translateY(-50%);
			background: rgba(255,255,255,0.9);
			border-radius: 10px;
			padding: 5px;
			box-shadow: 0 0 5px rgba(0,0,0,0.1);
			z-index: 100;
		}

		.alpha-nav ul {
			list-style: none;
			padding: 0;
			margin: 0;
			text-align: center;
		}

		.alpha-nav li {
			padding: 4px 6px;
			cursor: pointer;
			font-weight: bold;
			font-size: 14px;
			color: var(--primary-color);
		}

		.alpha-nav li:hover {
			background-color: var(--light-color);
		}
				
				
    
#stickySearchContainer {
    position: sticky;
    top: 0;
    background: white;
    z-index: 100;
    padding: 10px 0;
}


.pokemon-card[data-iv-percent] {
    position: relative;
    background-image: linear-gradient(
        to bottom,
        var(--iv-gradient-start),
        var(--iv-gradient-end)
    );
    background-blend-mode: multiply;
}

/* Radio button styles */
.filter-radio-group {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 10px;
}

.filter-radio {
    display: none;
}

.filter-radio-label {
    padding: 6px 12px;
    border-radius: 4px;
    background-color: #f5f5f5;
    cursor: pointer;
    font-size: 14px;
    transition: all 0.2s;
}

.filter-radio:checked + .filter-radio-label {
    background-color: var(--primary-color);
    color: white;
}

.filter-radio-label:hover {
    background-color: #e0e0e0;
}

    /* Shadow Pokemon - Darker purple aura with smoke effect */
    .pokemon-card.shadow {
        position: relative;
        overflow: hidden;
        background: linear-gradient(135deg, #f5f5f5 0%, #e0e0e0 100%);
    }
    
    .pokemon-card.shadow::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        right: -50%;
        bottom: -50%;
        background: 
            radial-gradient(circle at center, rgba(91, 15, 153, 0.6) 0%, transparent 70%),
            url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200"><path fill="rgba(91, 15, 153, 0.4)" d="M30,50 Q50,30 70,50 T110,50 Q130,30 150,50 T190,50 Q210,30 230,50 T270,50 Q290,30 310,50 T350,50 Q370,30 390,50 T430,50 Q450,30 470,50 T510,50 Q530,30 550,50 T590,50 Q610,30 630,50 T670,50 Q690,30 710,50 T750,50 Q770,30 790,50 T830,50 Q850,30 870,50 T910,50 Q930,30 950,50 T990,50 Q1010,30 1030,50" transform="translate(-30,-50)"/></svg>');
        background-size: 200px 200px;
        z-index: 0;
        animation: 
            pulseAura 3s infinite ease-in-out alternate,
            floatSmoke 25s infinite linear;
        filter: blur(2px);
    }
    
    /* Shiny Pokemon - Fixed sparkle background with gradient */
    .pokemon-card.shiny {
        position: relative;
        overflow: hidden;
        background: linear-gradient(135deg, #fff 0%, #fff 50%, #fffde7 100%);
    }
    
    .pokemon-card.shiny::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-image: 
            radial-gradient(circle at 20% 30%, rgba(255, 255, 255, 0.9) 0%, transparent 25%),
            radial-gradient(circle at 80% 70%, rgba(255, 255, 255, 0.9) 0%, transparent 25%),
            radial-gradient(circle at 40% 80%, rgba(255, 255, 255, 0.9) 0%, transparent 25%),
            radial-gradient(circle at 60% 20%, rgba(255, 255, 255, 0.9) 0%, transparent 25%),
            radial-gradient(circle at 30% 60%, rgba(255, 255, 255, 0.9) 0%, transparent 25%),
            radial-gradient(circle at 70% 40%, rgba(255, 255, 255, 0.9) 0%, transparent 25%);
        z-index: 0;
        animation: twinkle 2s infinite;
    }
    
    /* Lucky Pokemon - More dynamic golden clouds */
    .pokemon-card.lucky {
        position: relative;
        overflow: hidden;
        background: linear-gradient(135deg, #fff 0%, #fff 70%, #fff9c4 100%);
    }
    
    .pokemon-card.lucky::before,
    .pokemon-card.lucky::after {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        right: -50%;
        bottom: -50%;
        background: 
            radial-gradient(circle at 30% 40%, rgba(255, 215, 0, 0.4) 0%, transparent 50%),
            url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200"><path fill="rgba(255, 215, 0, 0.3)" d="M30,30 Q50,10 70,30 T110,30 Q130,10 150,30 T190,30 Q210,10 230,30 T270,30 Q290,10 310,30 T350,30 Q370,10 390,30 T430,30 Q450,10 470,30 T510,30 Q530,10 550,30 T590,30 Q610,10 630,30 T670,30 Q690,10 710,30 T750,30 Q770,10 790,30 T830,30 Q850,10 870,30 T910,30 Q930,10 950,30 T990,30 Q1010,10 1030,30" transform="translate(-30,-30)"/></svg>');
        background-size: 200px 200px;
        z-index: 0;
        animation: floatCloud 20s infinite linear;
    }
    
    .pokemon-card.lucky::after {
        animation: floatCloudReverse 25s infinite linear;
        opacity: 0.7;
        background-position: 100px 100px;
    }
    
    /* Animations */
    @keyframes pulseAura {
        0% { opacity: 0.8; transform: scale(0.98); }
        100% { opacity: 1; transform: scale(1.02); }
    }
    
    @keyframes floatSmoke {
        0% { background-position: 0 0; }
        100% { background-position: 200px 200px; }
    }
    
    @keyframes twinkle {
        0%, 100% { opacity: 0.8; }
        50% { opacity: 1; }
    }
    
    @keyframes floatCloud {
        0% { 
            transform: translateX(0) translateY(0);
            background-position: 0 0;
        }
        25% { 
            transform: translateX(-20px) translateY(-15px);
            background-position: 50px 50px;
        }
        50% { 
            transform: translateX(0) translateY(-30px);
            background-position: 100px 100px;
        }
        75% { 
            transform: translateX(20px) translateY(-15px);
            background-position: 150px 150px;
        }
        100% { 
            transform: translateX(0) translateY(0);
            background-position: 200px 200px;
        }
    }
    
    @keyframes floatCloudReverse {
        0% { 
            transform: translateX(0) translateY(0);
            background-position: 200px 200px;
        }
        25% { 
            transform: translateX(15px) translateY(20px);
            background-position: 150px 150px;
        }
        50% { 
            transform: translateX(30px) translateY(0);
            background-position: 100px 100px;
        }
        75% { 
            transform: translateX(15px) translateY(-20px);
            background-position: 50px 50px;
        }
        100% { 
            transform: translateX(0) translateY(0);
            background-position: 0 0;
        }
    }
    
    /* Ensure content stays above backgrounds */
    .pokemon-card > * {
        position: relative;
        z-index: 1;
    }
</style>
</head>
<body>
    <h1>Pok√©mon GO Collection Viewer</h1>
    
    <div class="controls">
        <div class="control-section">
            <h3>File Operations</h3>
            <div class="filters-row">
                <button id="loadSampleData">Load Sample Data</button>
                <button id="uploadJsonBtn">Upload JSON File</button>
                <button id="exportSelectedBtn" class="secondary">Export Selected</button>
            </div>
        </div>
        
        <div class="control-section">
            <h3>Basic Filters</h3>
            <div class="filters-row">
                <select id="sortBy">
                    <option value="number">Sort by Pok√©dex #</option>
                    <option value="cp">Sort by CP</option>
                    <option value="name">Sort by Name</option>
                    <option value="attack">Sort by Attack</option>
                    <option value="defence">Sort by Defense</option>
                    <option value="stamina">Sort by Stamina</option>
                </select>
                
                <select id="filterStatus">
                    <option value="all">All Pok√©mon</option>
                    <option value="shiny">Shiny</option>
                    <option value="shadow">Shadow</option>
                    <option value="lucky">Lucky</option>
                </select>
                <input type="text" id="searchInput" placeholder="Search by name (use , for OR, & for AND)...">            </div>
            
            <div class="filter-radio-group">
                <input type="radio" id="filterNone" name="specialFilter" value="none" class="filter-radio" checked>
                <label for="filterNone" class="filter-radio-label">None</label>
                
                <input type="radio" id="filterShiny" name="specialFilter" value="shiny" class="filter-radio">
                <label for="filterShiny" class="filter-radio-label">Shinies</label>
                
                <input type="radio" id="filterLucky" name="specialFilter" value="lucky" class="filter-radio">
                <label for="filterLucky" class="filter-radio-label">Luckys</label>
                
                <input type="radio" id="filterShadow" name="specialFilter" value="shadow" class="filter-radio">
                <label for="filterShadow" class="filter-radio-label">Shadows</label>
                
                <input type="radio" id="filterPurified" name="specialFilter" value="purified" class="filter-radio">
                <label for="filterPurified" class="filter-radio-label">Purified</label>
                
                <input type="radio" id="filterHundo" name="specialFilter" value="hundo" class="filter-radio">
                <label for="filterHundo" class="filter-radio-label">Hundos</label>
                
                <input type="radio" id="filterNundo" name="specialFilter" value="nundo" class="filter-radio">
                <label for="filterNundo" class="filter-radio-label">Nundos</label>
                
                <input type="radio" id="filterNickname" name="specialFilter" value="nickname" class="filter-radio">
                <label for="filterNickname" class="filter-radio-label">Nicknames</label>
            </div>
        </div>
        
        <div class="control-section">
            <h3>Advanced Filters</h3>
            <div class="filters-row">
                <select id="filterMove">
                    <option value="">Any Move</option>
                    <!-- Will be populated dynamically -->
                </select>
                
                <select id="filterGender">
                    <option value="">Any Gender</option>
                    <option value="MALE">Male</option>
                    <option value="FEMALE">Female</option>
                    <option value="GENDERLESS">Genderless</option>
                </select>
                
                <select id="filterForm">
                    <option value="">Any Form</option>
                    <!-- Will be populated dynamically -->
                </select>
                
                <select id="filterCostume">
                    <option value="">Any Costume</option>
                    <!-- Will be populated dynamically -->
                </select>

                <select id="filterType">
                    <option value="">Any Type</option>
                    <option value="NORMAL">Normal</option>
                    <option value="FIRE">Fire</option>
                    <option value="WATER">Water</option>
                    <option value="GRASS">Grass</option>
                    <option value="ELECTRIC">Electric</option>
                    <option value="ICE">Ice</option>
                    <option value="FIGHTING">Fighting</option>
                    <option value="POISON">Poison</option>
                    <option value="GROUND">Ground</option>
                    <option value="FLYING">Flying</option>
                    <option value="PSYCHIC">Psychic</option>
                    <option value="BUG">Bug</option>
                    <option value="ROCK">Rock</option>
                    <option value="GHOST">Ghost</option>
                    <option value="DRAGON">Dragon</option>
                    <option value="DARK">Dark</option>
                    <option value="STEEL">Steel</option>
                    <option value="FAIRY">Fairy</option>
                </select>
            </div>
            
            <div class="filters-row">
                <div class="toggle-container">
                    <label class="switch">
                        <input type="checkbox" id="toggleAdvancedFilters">
                        <span class="slider"></span>
                    </label>
                    <span class="toggle-label">Show Stat Filters</span>
                </div>
            </div>
            
            <div id="advancedFiltersContainer" class="hidden">
                <div class="filters-row">
                    <div style="display: flex; flex-direction: column; min-width: 150px;">
                        <label for="cpMin">CP Range:</label>
                        <div style="display: flex; gap: 5px;">
                            <input type="number" id="cpMin" placeholder="Min" style="min-width: 70px; width: 70px;">
                            <input type="number" id="cpMax" placeholder="Max" style="min-width: 70px; width: 70px;">
                        </div>
                    </div>
                    
                    <div style="display: flex; flex-direction: column; min-width: 150px;">
                        <label for="attackMin">Attack IV:</label>
                        <div style="display: flex; gap: 5px;">
                            <input type="number" id="attackMin" placeholder="Min" min="0" max="15" style="min-width: 70px; width: 70px;">
                            <input type="number" id="attackMax" placeholder="Max" min="0" max="15" style="min-width: 70px; width: 70px;">
                        </div>
                    </div>
                    
                    <div style="display: flex; flex-direction: column; min-width: 150px;">
                        <label for="defenceMin">Defense IV:</label>
                        <div style="display: flex; gap: 5px;">
                            <input type="number" id="defenceMin" placeholder="Min" min="0" max="15" style="min-width: 70px; width: 70px;">
                            <input type="number" id="defenceMax" placeholder="Max" min="0" max="15" style="min-width: 70px; width: 70px;">
                        </div>
                    </div>
                    
                    <div style="display: flex; flex-direction: column; min-width: 150px;">
                        <label for="staminaMin">Stamina IV:</label>
                        <div style="display: flex; gap: 5px;">
                            <input type="number" id="staminaMin" placeholder="Min" min="0" max="15" style="min-width: 70px; width: 70px;">
                            <input type="number" id="staminaMax" placeholder="Max" min="0" max="15" style="min-width: 70px; width: 70px;">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="stats-container" id="statsContainer">
        <div class="stat-box">
            <div class="stat-value" id="totalPokemon">0</div>
            <div class="stat-label">Total Pok√©mon</div>
        </div>
        <div class="stat-box">
            <div class="stat-value" id="uniquePokemon">0</div>
            <div class="stat-label">Unique Species</div>
        </div>
        <div class="stat-box">
            <div class="stat-value" id="shinyCount">0</div>
            <div class="stat-label">Shiny</div>
        </div>
        <div class="stat-box">
            <div class="stat-value" id="shadowCount">0</div>
            <div class="stat-label">Shadow</div>
        </div>
        <div class="stat-box">
            <div class="stat-value" id="luckyCount">0</div>
            <div class="stat-label">Lucky</div>
        </div>
        <div class="stat-box">
            <div class="stat-value" id="avgCp">0</div>
            <div class="stat-label">Average CP</div>
        </div>
        <div class="stat-box">
            <div class="stat-value" id="avgIv">0%</div>
            <div class="stat-label">Average IV</div>
        </div>
    </div>
    
    <div class="selection-tools">
        <h3>Selection Tools</h3>
        <div class="filters-row">
            <button id="selectAllBtn">Select All Visible</button>
            <button id="deselectAllBtn">Deselect All</button>
            <span id="selectedCount" style="margin-left: auto;">0 selected</span>
        </div>
    </div>

    
    <div id="pokemonGrid" class="pokemon-grid">
        <!-- Pok√©mon cards will be inserted here -->
    </div>
    
    <div class="load-more-container">
        <button id="loadMoreBtn" class="hidden">Load More</button>
    </div>
    
    <!-- Modal for detailed Pok√©mon view -->
    <div id="pokemonModal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Pok√©mon Details</h2>
                <button class="close-modal" id="closeModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="modal-details" id="modalDetails">
                    <!-- Details will be inserted here -->
                </div>
            </div>
            <div class="modal-footer">
                <button id="closeModalBtn">Close</button>
            </div>
        </div>
    </div>

    <script>
	console.log("Script loaded");

        // Global variables
let pokemonData = {};
let filteredPokemonIds = [];
let selectedPokemonIds = new Set();
let allMoves = new Set();
let allForms = new Set();
let allCostumes = new Set();
let displayLimit = 50;
let currentlyDisplayed = 0;
let masterUrl = "";

// DOM Elements
const elements = {
    pokemonGrid: document.getElementById('pokemonGrid'),
    searchInput: document.getElementById('searchInput'),
	sortBy: document.getElementById('sortBy'),
    filterStatus: document.getElementById('filterStatus'),
    filterMove: document.getElementById('filterMove'),
    filterGender: document.getElementById('filterGender'),
    filterForm: document.getElementById('filterForm'),
    filterCostume: document.getElementById('filterCostume'),
    loadSampleDataBtn: document.getElementById('loadSampleData'),
    uploadJsonBtn: document.getElementById('uploadJsonBtn'),
    advancedFiltersToggle: document.getElementById('toggleAdvancedFilters'),
    advancedFiltersContainer: document.getElementById('advancedFiltersContainer'),
    cpMin: document.getElementById('cpMin'),
    cpMax: document.getElementById('cpMax'),
    attackMin: document.getElementById('attackMin'),
    attackMax: document.getElementById('attackMax'),
    defenceMin: document.getElementById('defenceMin'),
    defenceMax: document.getElementById('defenceMax'),
    staminaMin: document.getElementById('staminaMin'),
    staminaMax: document.getElementById('staminaMax'),
    selectAllBtn: document.getElementById('selectAllBtn'),
    deselectAllBtn: document.getElementById('deselectAllBtn'),
    selectedCount: document.getElementById('selectedCount'),
    exportSelectedBtn: document.getElementById('exportSelectedBtn'),
    // Stats elements
    totalPokemon: document.getElementById('totalPokemon'),
    uniquePokemon: document.getElementById('uniquePokemon'),
    shinyCount: document.getElementById('shinyCount'),
    shadowCount: document.getElementById('shadowCount'),
    luckyCount: document.getElementById('luckyCount'),
    avgCp: document.getElementById('avgCp'),
    avgIv: document.getElementById('avgIv'),
    // Modal elements
    pokemonModal: document.getElementById('pokemonModal'),
    modalTitle: document.getElementById('modalTitle'),
    modalDetails: document.getElementById('modalDetails'),
    closeModal: document.getElementById('closeModal'),
    closeModalBtn: document.getElementById('closeModalBtn'),
    // Load more button
    loadMoreBtn: document.getElementById('loadMoreBtn'),
    // Radio buttons
    filterNone: document.getElementById('filterNone'),
    filterShiny: document.getElementById('filterShiny'),
    filterLucky: document.getElementById('filterLucky'),
    filterShadow: document.getElementById('filterShadow'),
    filterPurified: document.getElementById('filterPurified'),
    filterHundo: document.getElementById('filterHundo'),
    filterNundo: document.getElementById('filterNundo'),
    filterNickname: document.getElementById('filterNickname')
};

// Utility functions

function getIVColor(percent) {
    const red = [255, 0, 0];
    const green = [0, 255, 0];
    const mix = percent / 100;
    const blend = (a, b) => Math.round(a + (b - a) * Math.pow(mix,1.5));
    const r = blend(red[0], green[0]);
    const g = blend(red[1], green[1]);
    const b = blend(red[2], green[2]);
    return {
        start: `rgba(${r}, ${g}, ${b}, 0.5)`,
        end: `rgba(${r}, ${g}, ${b}, 0.275)`
    };
}

function getTypeColor(type) {
    const typeColors = {
        NORMAL: '#A8A878',
        FIRE: '#F08030',
        WATER: '#6890F0',
        GRASS: '#78C850',
        ELECTRIC: '#F8D030',
        ICE: '#98D8D8',
        FIGHTING: '#C03028',
        POISON: '#A040A0',
        GROUND: '#E0C068',
        FLYING: '#A890F0',
        PSYCHIC: '#F85888',
        BUG: '#A8B820',
        ROCK: '#B8A038',
        GHOST: '#705898',
        DRAGON: '#7038F8',
        DARK: '#705848',
        STEEL: '#B8B8D0',
        FAIRY: '#EE99AC',
        WINDY: '#AA9',
        SUNNY: '#FC0',
        RAINY: '#39F',
        PARTLY_CLOUDY: '#AB9',
        CLOUDY: '#ABC',
        FOG: '#BBB',
        SNOW: '#BDF'
    };
    
    return typeColors[type] || '#777777';
}

function formatMoveName(moveName) {
    if (!moveName) return '';
    return moveName
        .replace(/_FAST/g, '')
        .split('_')
        .map(word => word.charAt(0) + word.slice(1).toLowerCase())
        .join(' ');
}

function getGenderSymbol(gender) {
    if (gender === 'MALE') return '<span class="gender-male">‚ôÇ</span>';
    if (gender === 'FEMALE') return '<span class="gender-female">‚ôÄ</span>';
    return '<span class="gender-neutral">‚ö™</span>';
}

function calculateIVPercentage(attack, defence, stamina) {
    // IV percentage is calculated as (A + D + S) / 45 * 100
    return ((attack + defence + stamina) / 45 * 100).toFixed(2);
}// Function to create a Pok√©mon card
function createPokemonCard(id, pokemon) {
    const isShiny = pokemon.mon_isshiny === 'YES';
    const isLucky = pokemon.mon_islucky === 'YES';
    const isShadow = pokemon.mon_alignment === 'SHADOW';
    const pokeNumber = pokemon.mon_number.toString();

    // Create Sprite URL 
    let spriteUrl = `https://raw.githubusercontent.com/bluecereal127/BetterDex/master/pm${pokeNumber}`;

    // Check for form variations
    let pm_form = "";
    if(pokemon.mon_form) pm_form = pokemon.mon_form;
    let formPart = pm_form.substring(pm_form.indexOf('_')+1);
    let finalForm = (formPart === "NORMAL" && pm_form !== "KYUREM_NORMAL" && pm_form !== "GENESECT_NORMAL" && pm_form.substring(0,5) != "UNOWN") ? "" : formPart;
    
    if(finalForm !== "") spriteUrl += '.f'+finalForm;
    
    let pm_costume = "";
    if(pokemon.mon_costume) pm_costume = pokemon.mon_costume;
    if(pm_costume !== "") spriteUrl += '.c'+pm_costume;

    if (pokemon.mon_isshiny === 'YES') {
        spriteUrl += '.s';
    }
    spriteUrl += '.icon.png';
    masterUrl = spriteUrl;

    // Calculate IV percentage
    const attackIV = Number(pokemon.mon_attack) || 0;
    const defenceIV = Number(pokemon.mon_defence) || 0;
    const staminaIV = Number(pokemon.mon_stamina) || 0;
    const ivPercentage = calculateIVPercentage(attackIV, defenceIV, staminaIV);
    
    // Create card element
    const card = document.createElement('div');
    card.className = `pokemon-card ${isShiny ? 'shiny' : ''} ${isLucky ? 'lucky' : ''} ${isShadow ? 'shadow' : ''}`;
    card.dataset.id = id;
    card.onclick = () => togglePokemonSelection(id, pokemon);
    card.ondblclick = (event) => {
        event.preventDefault();
        showPokemonDetails(id, pokemon);
    };
    
    // Build card content
    card.innerHTML = `
        <div class="sprite-container">
            <img src="${spriteUrl}" alt="${pokemon.mon_name}" class="sprite" onerror="this.src='https://raw.githubusercontent.com/bluecereal127/BetterDex/master/pm${pokeNumber}.icon.png'">
        </div>
        
        <div class="pokemon-name">
            ${pokemon.mon_nickname 
                ? `${pokemon.mon_nickname}` 
                : pokemon.mon_form && !pokemon.mon_form.endsWith('_NORMAL') 
                ? pokemon.mon_form.replace(`${pokemon.mon_name}_`, ' ') 
                : pokemon.mon_costume 
                    ? `${pokemon.mon_costume} : ${pokemon.mon_name}` 
                    : pokemon.mon_name}
                    ${getGenderSymbol(pokemon.mon_gender)}
            </div>
            <div class="pokemon-cp">CP ${pokemon.mon_cp}</div>
        
        <div class="stats">
            <div class="stat">
                <div class="stat-value">${attackIV}</div>
                <div class="stat-label">ATK</div>
            </div>
            <div class="stat">
                <div class="stat-value">${defenceIV}</div>
                <div class="stat-label">DEF</div>
            </div>
            <div class="stat">
                <div class="stat-value">${staminaIV}</div>
                <div class="stat-label">STA</div>
            </div>
        </div>
        
        <div class="move">${formatMoveName(pokemon.mon_move_1)}</div>
        <div class="move">${formatMoveName(pokemon.mon_move_2)}${" " + formatMoveName(pokemon.mon_move_3)}</div>
    `;
    
    if (selectedPokemonIds.has(id)) {
        card.classList.add('selected');
    }
    
    const percent = parseFloat(ivPercentage);
    const color = getIVColor(percent);
    card.style.setProperty('--iv-gradient-start', color.start);
    card.style.setProperty('--iv-gradient-end', color.end);
    card.dataset.ivPercent = ivPercentage;

    return card;
}

// Function to toggle Pokemon selection
function togglePokemonSelection(id, pokemon) {
    if (selectedPokemonIds.has(id)) {
        selectedPokemonIds.delete(id);
        document.querySelector(`.pokemon-card[data-id="${id}"]`).classList.remove('selected');
    } else {
        selectedPokemonIds.add(id);
        document.querySelector(`.pokemon-card[data-id="${id}"]`).classList.add('selected');
    }
    
    elements.selectedCount.textContent = `${selectedPokemonIds.size} selected`;
}

// Function to show Pokemon details in modal
function showPokemonDetails(id, pokemon) {
    const isShiny = pokemon.mon_isshiny === 'YES';
    const isLucky = pokemon.mon_islucky === 'YES';
    const isShadow = pokemon.mon_alignment === 'SHADOW';
    const isPurified = pokemon.mon_alignment === 'PURIFIED';
    const pokeNumber = pokemon.mon_number.toString();
    
    let spriteUrl = `https://raw.githubusercontent.com/bluecereal127/BetterDex/master/pm${pokeNumber}${isShiny ? '.s.icon' : '.icon'}.png`;

    let pm_form = "";
    if(pokemon.mon_form) pm_form = pokemon.mon_form;
    let formPart = pm_form.substring(pm_form.indexOf('_')+1);
    let finalForm = (formPart === "NORMAL" && pm_form !== "KYUREM_NORMAL" && pm_form !== "GENESECT_NORMAL") ? "" : formPart;
    
    if(finalForm !== "") spriteUrl += '.f'+finalForm;
    
    let pm_costume = "";
    if(pokemon.mon_costume) pm_costume = pokemon.mon_costume;
    if(pm_costume !== "") spriteUrl += '.c'+pm_costume;

    if (pokemon.mon_isshiny === 'YES') {
        spriteUrl += '.s';
    }
    spriteUrl += '.icon.png';
    
    // Calculate IV percentage
    const attackIV = Number(pokemon.mon_attack) || 0;
    const defenceIV = Number(pokemon.mon_defence) || 0;
    const staminaIV = Number(pokemon.mon_stamina) || 0;
    const ivPercentage = calculateIVPercentage(attackIV, defenceIV, staminaIV);
    
    // Set modal title
    elements.modalTitle.innerHTML = `${pokemon.mon_name} ${getGenderSymbol(pokemon.mon_gender)} ${isShiny ? '‚ú®' : ''} ${isShadow ? 'üëø' : ''} ${isLucky ? 'üçÄ' : ''}`;
    
    masterUrl = spriteUrl;
    
    // Build modal content
    elements.modalDetails.innerHTML = `
        <div class="detail-pokemon-sprite">
            <img src="${spriteUrl}" alt="${pokemon.mon_name}" class="sprite" onerror="this.src='https://raw.githubusercontent.com/bluecereal127/BetterDex/master/pm${pokeNumber}.icon.png'">
            <div class="pokemon-number">${pokemon.mon_nickname ? `<strong>${pokemon.mon_nickname}</strong>` : `${pokemon.mon_form && !pokemon.mon_form.endsWith('_NORMAL') ? `${pokemon.mon_form.replace((pokemon.mon_name)+'_', ' ')}` : ''}`}</div>
        </div>
        
        <div class="detail-pokemon-info">
            <div class="detail-section">
                <h3>Basic Information</h3>
                <table class="detail-table">
                    <tr>
                        <th>CP</th>
                        <td>${pokemon.mon_cp}</td>
                    </tr>
                    <tr>
                        <th>HP</th>
                        <td>${pokemon.mon_stamina}</td>
                    </tr>
                    <tr>
                        <th>Type</th>
                        <td>${pokemon.mon_type_1}${pokemon.mon_type_2 ? ' / ' + pokemon.mon_type_2 : ''}</td>
                    </tr>
                    <tr>
                        <th>Special Attributes</th>
                        <td>
                            ${isShiny ? '<span class="badge shiny-badge">Shiny</span>' : ''}
                            ${isShadow ? '<span class="badge shadow-badge">Shadow</span>' : ''}
                            ${isPurified ? '<span class="badge">Purified</span>' : ''}
                            ${isLucky ? '<span class="badge lucky-badge">Lucky</span>' : ''}
                        </td>
                    </tr>
                    <tr>
                        <th>Caught Date</th>
                        <td>${pokemon.mon_timestamp || 'Unknown'}</td>
                    </tr>
                </table>
            </div>
            
            <div class="detail-section">
                <h3>Individual Values (IV)</h3>
                <div class="detail-stats">
                    <div class="detail-stat-box">
                        <div>Attack</div>
                        <div style="font-weight: bold;">${attackIV}/15</div>
                        <div class="stat-bar-container">
                            <div class="stat-bar stat-bar-attack" style="width: ${(attackIV / 15) * 100}%"></div>
                        </div>
                    </div>
                    <div class="detail-stat-box">
                        <div>Defense</div>
                        <div style="font-weight: bold;">${defenceIV}/15</div>
                        <div class="stat-bar-container">
                            <div class="stat-bar stat-bar-defence" style="width: ${(defenceIV / 15) * 100}%"></div>
                        </div>
                    </div>
                    <div class="detail-stat-box">
                        <div>Stamina</div>
                        <div style="font-weight: bold;">${staminaIV}/15</div>
                        <div class="stat-bar-container">
                            <div class="stat-bar stat-bar-stamina" style="width: ${(staminaIV / 15) * 100}%"></div>
                        </div>
                    </div>
                    <div class="detail-stat-box">
                        <div>Total IV</div>
                        <div style="font-weight: bold;">${ivPercentage}%</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${ivPercentage}%"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="detail-section">
                <h3>Moves</h3>
                <div class="detail-moves">
                    <div class="detail-move">
                        <div style="font-size: 12px; color: #777;">Fast Move</div>
                        <div style="font-weight: bold;">${formatMoveName(pokemon.mon_move_1)}</div>
                        <div style="font-size: 12px;">Type: ${pokemon.mon_move_1_type || 'Unknown'}</div>
                    </div>
                    <div class="detail-move">
                        <div style="font-size: 12px; color: #777;">Charged Move</div>
                        <div style="font-weight: bold;">${formatMoveName(pokemon.mon_move_2)}</div>
                        <div style="font-size: 12px;">Type: ${pokemon.mon_move_2_type || 'Unknown'}</div>
                    </div>
                    ${pokemon.mon_move_3 ? `
                    <div class="detail-move">
                        <div style="font-size: 12px; color: #777;">Charged Move 2</div>
                        <div style="font-weight: bold;">${formatMoveName(pokemon.mon_move_3)}</div>
                        <div style="font-size: 12px;">Type: ${pokemon.mon_move_3_type || 'Unknown'}</div>
                    </div>
                    ` : ''}
                </div>
            </div>
            
            <div class="detail-section">
                <h3>Additional Details</h3>
                <table class="detail-table">
                    <tr>
                        <th>Height</th>
                        <td>${pokemon.mon_height} m</td>
                    </tr>
                    <tr>
                        <th>Weight</th>
                        <td>${pokemon.mon_weight} kg</td>
                    </tr>
                    <tr>
                        <th>Level</th>
                        <td>${pokemon.mon_level || 'Unknown'}</td>
                    </tr>
                    <tr>
                        <th>Form</th>
                        <td>${pokemon.mon_form ? pokemon.mon_form.replace('_', ' ') : 'Normal'}</td>
                    </tr>
                    <tr>
                        <th>Costume</th>
                        <td>${pokemon.mon_costume ? pokemon.mon_costume.replace('_', ' ') : 'None'}</td>
                    </tr>
                </table>
            </div>
        </div>
    `;
    
    // Show modal
    elements.pokemonModal.classList.remove('hidden');
}

// Function to filter and sort Pokemon
// Replace the existing filterAndSortPokemon function with this enhanced version
function filterAndSortPokemon() {
    filteredPokemonIds = [];
    
    const searchText = elements.searchInput.value.toLowerCase();
    const sortBy = elements.sortBy.value;
    const filterStatus = elements.filterStatus.value;
    const filterMove = elements.filterMove.value;
    const filterGender = elements.filterGender.value;
    const filterForm = elements.filterForm.value;
    const filterCostume = elements.filterCostume.value;
    
    // Get selected radio filter
    let specialFilter = '';
    if (elements.filterShiny.checked) specialFilter = 'shiny';
    else if (elements.filterLucky.checked) specialFilter = 'lucky';
    else if (elements.filterShadow.checked) specialFilter = 'shadow';
    else if (elements.filterPurified.checked) specialFilter = 'purified';
    else if (elements.filterHundo.checked) specialFilter = 'hundo';
    else if (elements.filterNundo.checked) specialFilter = 'nundo';
    else if (elements.filterNickname.checked) specialFilter = 'nickname';
    
    // Advanced filters
    const cpMin = elements.cpMin.value !== '' ? parseInt(elements.cpMin.value) : 0;
    const cpMax = elements.cpMax.value !== '' ? parseInt(elements.cpMax.value) : Infinity;
    const attackMin = elements.attackMin.value !== '' ? parseInt(elements.attackMin.value) : 0;
    const attackMax = elements.attackMax.value !== '' ? parseInt(elements.attackMax.value) : 15;
    const defenceMin = elements.defenceMin.value !== '' ? parseInt(elements.defenceMin.value) : 0;
    const defenceMax = elements.defenceMax.value !== '' ? parseInt(elements.defenceMax.value) : 15;
    const staminaMin = elements.staminaMin.value !== '' ? parseInt(elements.staminaMin.value) : 0;
    const staminaMax = elements.staminaMax.value !== '' ? parseInt(elements.staminaMax.value) : 15;
    
    // Parse search terms (supporting comma/pipe for OR, ampersand for AND)
    let searchTerms = [];
    if (searchText) {
        // First split by ampersands (AND groups)
        const andGroups = searchText.split('&').map(group => group.trim());
        
        // Then split each AND group by commas/pipes (OR terms)
        searchTerms = andGroups.map(group => {
            return group.split(/[,|]/).map(term => term.trim()).filter(term => term);
        });
    }
    
    // Filter Pokemon
    for (const id in pokemonData) {
        const pokemon = pokemonData[id];
        let matchesSearch = true;
        
        // Handle search terms if they exist
        if (searchTerms.length > 0) {
            matchesSearch = searchTerms.every(orGroup => {
                // At least one term in the OR group must match
                return orGroup.some(term => {
                    // Check if term matches name or number
                    return pokemon.mon_name.toLowerCase().includes(term) || 
                           pokemon.mon_number.toString().includes(term);
                });
            });
        }
        
        if (!matchesSearch) continue;
        
        // Status filter
        if (filterStatus === 'shiny' && pokemon.mon_isshiny !== 'YES') continue;
        if (filterStatus === 'shadow' && pokemon.mon_alignment !== 'SHADOW') continue;
        if (filterStatus === 'lucky' && pokemon.mon_islucky !== 'YES') continue;
        
        // Special radio filters
        if (specialFilter === 'shiny' && pokemon.mon_isshiny !== 'YES') continue;
        if (specialFilter === 'lucky' && pokemon.mon_islucky !== 'YES') continue;
        if (specialFilter === 'shadow' && pokemon.mon_alignment !== 'SHADOW') continue;
        if (specialFilter === 'purified' && pokemon.mon_alignment !== 'PURIFIED') continue;
        if (specialFilter === 'hundo') {
            const totalIV = (parseInt(pokemon.mon_attack) || 0) + 
                          (parseInt(pokemon.mon_defence) || 0) + 
                          (parseInt(pokemon.mon_stamina) || 0);
            if (totalIV !== 45) continue;
        }
        if (specialFilter === 'nundo') {
            const totalIV = (parseInt(pokemon.mon_attack) || 0) + 
                          (parseInt(pokemon.mon_defence) || 0) + 
                          (parseInt(pokemon.mon_stamina) || 0);
            if (totalIV !== 0) continue;
        }
        if (specialFilter === 'nickname' && !pokemon.mon_nickname) continue;
        
        // Move filter
        if (filterMove && 
            pokemon.mon_move_1 !== filterMove && 
            pokemon.mon_move_2 !== filterMove && 
            pokemon.mon_move_3 !== filterMove) {
            continue;
        }
        
        // Gender filter
        if (filterGender && pokemon.mon_gender !== filterGender) continue;
        
        // Form filter
        if (filterForm && pokemon.mon_form !== filterForm) continue;
        
        // Costume filter
        if (filterCostume && pokemon.mon_costume !== filterCostume) continue;
        
        // CP range filter
        const cp = parseInt(pokemon.mon_cp);
        if (cp < cpMin || cp > cpMax) continue;
        
        // IV filters
        const attackIV = Number(pokemon.mon_attack) || 0;
        const defenceIV = Number(pokemon.mon_defence) || 0;
        const staminaIV = Number(pokemon.mon_stamina) || 0;
        
        if (attackIV < attackMin || attackIV > attackMax) continue;
        if (defenceIV < defenceMin || defenceIV > defenceMax) continue;
        if (staminaIV < staminaMin || staminaIV > staminaMax) continue;
        
        filteredPokemonIds.push(id);
    }
    
    // Sort Pokemon (keep existing sort logic)
    filteredPokemonIds.sort((a, b) => {
        const pokemonA = pokemonData[a];
        const pokemonB = pokemonData[b];
        
        switch (sortBy) {
            case 'number':
                return parseInt(pokemonA.mon_number) - parseInt(pokemonB.mon_number);
            case 'cp':
                return parseInt(pokemonB.mon_cp) - parseInt(pokemonA.mon_cp);
            case 'name':
                return pokemonA.mon_name.localeCompare(pokemonB.mon_name);
            case 'attack':
                return parseInt(pokemonB.mon_attack) - parseInt(pokemonA.mon_attack);
            case 'defence':
                return parseInt(pokemonB.mon_defence) - parseInt(pokemonA.mon_defence);
            case 'stamina':
                return parseInt(pokemonB.mon_stamina) - parseInt(pokemonA.mon_stamina);
            default:
                return 0;
        }
    });
    
    displayPokemon(true);
}

// Function to display Pokemon
function displayPokemon(reset = false) {
    if (reset) {
        elements.pokemonGrid.innerHTML = '';
        currentlyDisplayed = 0;
    }
    
    const remaining = filteredPokemonIds.length - currentlyDisplayed;
    const toDisplay = Math.min(displayLimit, remaining);
    
    const displayIds = filteredPokemonIds.slice(currentlyDisplayed, currentlyDisplayed + toDisplay);
    
    for (const id of displayIds) {
        const pokemon = pokemonData[id];
        const card = createPokemonCard(id, pokemon);
        elements.pokemonGrid.appendChild(card);
    }
    
    currentlyDisplayed += toDisplay;
    elements.loadMoreBtn.classList.toggle('hidden', currentlyDisplayed >= filteredPokemonIds.length);
    
    if (filteredPokemonIds.length === 0) {
        elements.pokemonGrid.innerHTML = '<div style="grid-column: 1 / -1; text-align: center; padding: 50px; color: #777;">No Pok√©mon found matching your filters.</div>';
    }
}

// Function to populate dropdowns
function populateDropdowns() {
    while (elements.filterMove.options.length > 1) {
        elements.filterMove.remove(1);
    }
    
    while (elements.filterForm.options.length > 1) {
        elements.filterForm.remove(1);
    }
    
    while (elements.filterCostume.options.length > 1) {
        elements.filterCostume.remove(1);
    }
    
    // Add move options
    for (const move of Array.from(allMoves).sort()) {
        const option = document.createElement('option');
        option.value = move;
        option.textContent = formatMoveName(move);
        elements.filterMove.appendChild(option);
    }
    
    // Add form options
    for (const form of Array.from(allForms).sort()) {
        if (form.endsWith('_NORMAL') || form.endsWith('_STANDARD')) continue;
        const option = document.createElement('option');
        option.value = form;
        option.textContent = form ? form.replace('_', ' ') : 'Normal';
        elements.filterForm.appendChild(option);
    }
    
    // Add costume options
    for (const costume of Array.from(allCostumes).sort()) {
        if (!costume) continue;
        const option = document.createElement('option');
        option.value = costume;
        option.textContent = costume.replace('_', ' ');
        elements.filterCostume.appendChild(option);
    }
}

// Function to update stats
function updateStats() {
    if (Object.keys(pokemonData).length === 0) {
        return;
    }
    
    const totalPokemon = Object.keys(pokemonData).length;
    const uniqueSpecies = new Set();
    let shinyCount = 0;
    let shadowCount = 0;
    let luckyCount = 0;
    let totalCp = 0;
    let totalIv = 0;
    
    for (const id in pokemonData) {
        const pokemon = pokemonData[id];
        uniqueSpecies.add(pokemon.mon_number);
        
        if (pokemon.mon_isshiny === 'YES') shinyCount++;
        if (pokemon.mon_alignment === 'SHADOW') shadowCount++;
        if (pokemon.mon_islucky === 'YES') luckyCount++;
        
        totalCp += parseInt(pokemon.mon_cp) || 0;
        
        const attackIV = Number(pokemon.mon_attack) || 0;
        const defenceIV = Number(pokemon.mon_defence) || 0;
        const staminaIV = Number(pokemon.mon_stamina) || 0;
        totalIv += (attackIV + defenceIV + staminaIV) / 45;
    }
    
    elements.totalPokemon.textContent = totalPokemon;
    elements.uniquePokemon.textContent = uniqueSpecies.size;
    elements.shinyCount.textContent = shinyCount;
    elements.shadowCount.textContent = shadowCount;
    elements.luckyCount.textContent = luckyCount;
    elements.avgCp.textContent = Math.round(totalCp / totalPokemon);
    elements.avgIv.textContent = (totalIv / totalPokemon * 100).toFixed(2) + '%';
}

// Function to export selected pokemon to JSON
function exportSelectedPokemon() {
    if (selectedPokemonIds.size === 0) {
        alert('No Pok√©mon selected. Please select at least one Pok√©mon to export.');
        return;
    }
    
    const selectedPokemon = {};
    for (const id of selectedPokemonIds) {
        selectedPokemon[id] = pokemonData[id];
    }
    
    const jsonString = JSON.stringify(selectedPokemon, null, 2);
    const blob = new Blob([jsonString], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    
    const a = document.createElement('a');
    a.href = url;
    a.download = 'selected_pokemon.json';
    document.body.appendChild(a);
    a.click();
    
    setTimeout(() => {
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }, 100);
}

// Function to load sample data
function loadSampleData() {
    const sampleData = {
        "2953501956203385596" : {
            "mon_isshiny" : "YES",
            "mon_islucky" : "NO",
            "mon_weight" : 6.1410894393920898,
            "mon_move_1" : "HIDDEN_POWER_FAST",
            "mon_height" : 0.53191697597503662,
            "mon_gender" : "GENDERLESS",
            "mon_form" : "UNOWN_P",
            "mon_stamina" : 14,
            "mon_attack" : 12,
            "mon_name" : "UNOWN",
            "mon_move_2" : "STRUGGLE",
            "mon_cp" : 684,
            "mon_number" : 201,
            "mon_defence" : 12,
            "mon_weather_boost" : "WINDY"
        }
    };
    
    loadPokemonData(sampleData);
}

// Function to process uploaded JSON file
function handleFileUpload(event) {
    const fileInput = event.target;
    const file = fileInput.files[0];
    
    if (!file) {
        return;
    }
    
    const reader = new FileReader();
    
    reader.onload = function(e) {
        try {
            const data = JSON.parse(e.target.result);
            loadPokemonData(data);
        } catch (error) {
            alert('Error parsing JSON file: ' + error.message);
        }
    };
    
    reader.readAsText(file);
    fileInput.value = '';
}

// Function to load Pokemon data
function loadPokemonData(data) {
    pokemonData = data;
    selectedPokemonIds.clear();
    elements.selectedCount.textContent = '0 selected';
    
    allMoves = new Set();
    allForms = new Set();
    allCostumes = new Set();
    
    for (const id in pokemonData) {
        const pokemon = pokemonData[id];
        
        if (pokemon.mon_move_1) allMoves.add(pokemon.mon_move_1);
        if (pokemon.mon_move_2) allMoves.add(pokemon.mon_move_2);
        if (pokemon.mon_move_3) allMoves.add(pokemon.mon_move_3);
        if (pokemon.mon_form) allForms.add(pokemon.mon_form);
        if (pokemon.mon_costume) allCostumes.add(pokemon.mon_costume);
    }
    
    populateDropdowns();
    updateStats();
    filterAndSortPokemon();
}

// Function to select all visible Pokemon
function selectAllVisible() {
    for (const id of filteredPokemonIds) {
        selectedPokemonIds.add(id);
        const card = document.querySelector(`.pokemon-card[data-id="${id}"]`);
        if (card) {
            card.classList.add('selected');
        }
    }
    
    elements.selectedCount.textContent = `${selectedPokemonIds.size} selected`;
}

// Function to deselect all Pokemon
function deselectAll() {
    selectedPokemonIds.clear();
    const selectedCards = document.querySelectorAll('.pokemon-card.selected');
    for (const card of selectedCards) {
        card.classList.remove('selected');
    }
    
    elements.selectedCount.textContent = '0 selected';
}

// Event listeners
function setupEventListeners() {
    // Filter changes
    elements.searchInput.addEventListener('input', filterAndSortPokemon);
    elements.sortBy.addEventListener('change', filterAndSortPokemon);
    elements.filterStatus.addEventListener('change', filterAndSortPokemon);
    elements.filterMove.addEventListener('change', filterAndSortPokemon);
    elements.filterGender.addEventListener('change', filterAndSortPokemon);
    elements.filterForm.addEventListener('change', filterAndSortPokemon);
    elements.filterCostume.addEventListener('change', filterAndSortPokemon);
    
    // Radio button filters
    elements.filterShiny.addEventListener('change', filterAndSortPokemon);
    elements.filterLucky.addEventListener('change', filterAndSortPokemon);
    elements.filterShadow.addEventListener('change', filterAndSortPokemon);
    elements.filterPurified.addEventListener('change', filterAndSortPokemon);
    elements.filterHundo.addEventListener('change', filterAndSortPokemon);
    elements.filterNundo.addEventListener('change', filterAndSortPokemon);
    elements.filterNickname.addEventListener('change', filterAndSortPokemon);
    elements.filterNone.addEventListener('change', filterAndSortPokemon);
    
    // Advanced filters toggle
    elements.advancedFiltersToggle.addEventListener('change', function() {
        elements.advancedFiltersContainer.classList.toggle('hidden', !this.checked);
    });
    
    // Advanced filter changes
    elements.cpMin.addEventListener('input', filterAndSortPokemon);
    elements.cpMax.addEventListener('input', filterAndSortPokemon);
    elements.attackMin.addEventListener('input', filterAndSortPokemon);
    elements.attackMax.addEventListener('input', filterAndSortPokemon);
    elements.defenceMin.addEventListener('input', filterAndSortPokemon);
    elements.defenceMax.addEventListener('input', filterAndSortPokemon);
    elements.staminaMin.addEventListener('input', filterAndSortPokemon);
    elements.staminaMax.addEventListener('input', filterAndSortPokemon);
    
    // Selection tools
    elements.selectAllBtn.addEventListener('click', selectAllVisible);
    elements.deselectAllBtn.addEventListener('click', deselectAll);
    
    // Load more button
    elements.loadMoreBtn.addEventListener('click', function() {
        displayPokemon(false);
    });
    
    window.addEventListener('scroll', function () {
        if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight - 100) {
            displayPokemon(false);
        }
    });
    
    // Upload JSON file
    elements.uploadJsonBtn.addEventListener('click', function() {
        const fileInput = document.createElement('input');
        fileInput.type = 'file';
        fileInput.accept = '.json';
        fileInput.onchange = handleFileUpload;
        fileInput.click();
    });
    
    // Load sample data
    elements.loadSampleDataBtn.addEventListener('click', loadSampleData);
    
    // Export selected
    elements.exportSelectedBtn.addEventListener('click', exportSelectedPokemon);
    
    // Modal close
    elements.closeModal.addEventListener('click', function() {
        elements.pokemonModal.classList.add('hidden');
    });
    
    elements.closeModalBtn.addEventListener('click', function() {
        elements.pokemonModal.classList.add('hidden');
    });
    
    // Close modal when clicking outside
    elements.pokemonModal.addEventListener('click', function(event) {
        if (event.target === elements.pokemonModal) {
            elements.pokemonModal.classList.add('hidden');
        }
    });
    
    // Keyboard events
    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape' && !elements.pokemonModal.classList.contains('hidden')) {
            elements.pokemonModal.classList.add('hidden');
        }
    });
    
    document.querySelectorAll('.alpha-nav li').forEach(li => {
        li.addEventListener('click', () => {
            const letter = li.dataset.letter.toUpperCase();
            const targetCard = Array.from(document.querySelectorAll('.pokemon-card')).find(card => {
                const name = card.querySelector('.pokemon-name')?.textContent?.trim()?.toUpperCase();
                return name?.startsWith(letter);
            });

            if (targetCard) {
                targetCard.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        });
    });
}

// Initialize the app
function init() {
    setupEventListeners();
    
    // Add file reader element for uploads (hidden)
    const fileReader = document.createElement('input');
    fileReader.type = 'file';
    fileReader.id = 'fileInput';
    fileReader.accept = '.json';
    fileReader.style.display = 'none';
    document.body.appendChild(fileReader);
    
    // Show initial message
    elements.pokemonGrid.innerHTML = `
        <div style="grid-column: 1 / -1; text-align: center; padding: 50px; color: #777;">
            <p>Welcome to the Pok√©mon GO Collection Viewer!</p>
            <p>To get started, click "Load Sample Data" or "Upload JSON File".</p>
        </div>
    `;
}

// Start the app when DOM is loaded
document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>