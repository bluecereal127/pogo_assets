<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pok√©mon GO Collection Viewer</title>
    <style>
        :root {
            --primary-color: #e53935;
            --secondary-color: #2196f3;
            --accent-color: #ffc107;
            --dark-color: #333;
            --light-color: #f5f5f5;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --card-bg: white;
            --text-color: #333;
            --muted-text: #777;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 85%;
            margin: 0 auto;
            padding: 20px;
            background-color: var(--dark-color);
            color: var(--text-color);
            line-height: 1.6;
        }
        
        h1, h2, h3 {
            color: var(--primary-color);
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .controls {
            background-color: var(--card-bg);
            border-radius: 10px;
            box-shadow: 0 3px 10px var(--shadow-color);
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .control-section {
            margin-bottom: 15px;
        }
        
        .control-section:last-child {
            margin-bottom: 0;
        }
        
        .control-section h3 {
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .filters-row {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }
        
        .filters-row:last-child {
            margin-bottom: 0;
        }
        
        
        
        select, input, button {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: white;
            font-size: 14px;
        }
        
        select, input {
            min-width: 150px;
        }
        
        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
            min-width: auto;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        button:hover {
            background-color: #c62828;
        }
        
        button.secondary {
            background-color: var(--secondary-color);
        }
        
        button.secondary:hover {
            background-color: #1976d2;
        }
        
        button.accent {
            background-color: var(--accent-color);
            color: var(--dark-color);
        }
        
        button.accent:hover {
            background-color: #ffb300;
        }
        
        .stats-container {
            background-color: var(--card-bg);
            border-radius: 10px;
            box-shadow: 0 3px 10px var(--shadow-color);
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        /* .stats-container.selected-mode {
            border: 4px solid red;
            border-radius: 10px;
            padding: 8px;
        } */
        .stats-container.selected-mode .stat-box {
            border: 3px solid red;
            border-radius: 8px;
            padding: 4px;
        }
        .stats-container.filtered-mode {
            border: 2px solid gray;
            border-radius: 10px;
            padding: 8px;
        }

        .stats-container.filtered-mode .stat-box {
            border: 2px solid gray;
            border-radius: 8px;
            padding: 4px;
        }



        /* Match Shiny Card */
        .shiny-stat {
            position: relative;
            overflow: hidden;
            background: linear-gradient(135deg, #fff 0%, #fff 50%, #fffde7 100%);
        }
        .shiny-stat::before {
            content: '';
            position: absolute;
            inset: 0;
            background-image:
                radial-gradient(circle at 20% 30%, rgba(255, 255, 255, 0.9) 0%, transparent 25%),
                radial-gradient(circle at 80% 70%, rgba(255, 255, 255, 0.9) 0%, transparent 25%),
                radial-gradient(circle at 40% 80%, rgba(255, 255, 255, 0.9) 0%, transparent 25%),
                radial-gradient(circle at 60% 20%, rgba(255, 255, 255, 0.9) 0%, transparent 25%),
                radial-gradient(circle at 30% 60%, rgba(255, 255, 255, 0.9) 0%, transparent 25%);
            animation: twinkle 3s infinite ease-in-out;
            z-index: 0;
            pointer-events: none;
        }

        /* Match Shadow Card */
        .shadow-stat {
            position: relative;
            overflow: hidden;
            background: linear-gradient(135deg, #f5f5f5 0%, #e0e0e0 100%);
        }
        .shadow-stat::before {
            content: '';
            position: absolute;
            inset: -30%;
            background: radial-gradient(circle at center, rgba(91, 15, 153, 0.35) 0%, transparent 70%);
            animation: pulseAura 3s infinite ease-in-out alternate, floatSmoke 25s infinite linear;
            z-index: 0;
            pointer-events: none;
            filter: blur(4px);
            opacity: 0.9;
        }


        /* Match Lucky Card */
        .lucky-stat {
            position: relative;
            overflow: hidden;
            background: var(--card-bg);
        }
        .lucky-stat::after {
            content: '';
            position: absolute;
            inset: 0;
            background:
                radial-gradient(circle, rgba(255, 217, 0, 0.349) 0%, transparent 70%);
            animation: pulseAura 1s infinite ease-in-out alternate, floatCloudReverse 25s infinite linear;
            opacity: 0.7;
            background-position: 100px 100px;
            z-index: 0;
            pointer-events: none;
        }

        
        .stat-box {
            flex: 1;
            min-width: 150px;
            text-align: center;
            padding: 15px;
            background-color: #f5f5f5;
            border-radius: 8px;
        }



        
        .stat-value {
            font-size: 22px;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .stat-label {
            font-size: 15px;
            color: var(--muted-text);
        }
        
        .selection-tools {
            background-color: var(--card-bg);
            border-radius: 10px;
            box-shadow: 0 3px 10px var(--shadow-color);
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .selection-tools h3 {
            margin-bottom: 10px;
        }
        
        .search-string {
            padding: 10px;
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 10px 0;
            word-break: break-all;
            font-family: monospace;
        }
        
        .pokemon-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
        }
        
        /*---Pokemon Card styles---*/
        .pokemon-card {
            background-color: var(--card-bg);
            border-radius: 10px;
            box-shadow: 0 3px 10px var(--shadow-color);
            padding: 15px;
            text-align: center;
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
            cursor: pointer;
        }
        
        .pokemon-card:hover {
            transform: translateY(-12px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .pokemon-card.selected {
            border: 4px solid var(--primary-color);
            padding: 12px;
        }
        
        
        /*---New Type-based Filtering Grid ---*/
        
        .type-filter-grid {
            display: grid;
            grid-template-columns: repeat(6, auto);
            gap: 6px;
            margin-bottom: 1rem;
            justify-content: center;
        }
        .type-filter-grid .type-badge {
            cursor: pointer;
            opacity: 0.5;
            transition: opacity 0.2s ease;
            user-select: none;
        }
        
        .type-filter-grid .type-badge.selected {
            opacity: 1;
            border: 2px solid #000;
            border-radius: 8px;
            box-shadow: 0 0 10px 3px rgba(255, 255, 255, 0.5);
            transform: scale(1.05);
        }

        
        .clear-type-button {
            margin: 10px ;
            display: block;
            padding: 6px 12px;
            font-weight: bold;
            background: #ddd;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .clear-type-button:hover {
            background: #AFD;
        }



        .pokemon-types {
            display: flex;
            gap: 4px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 6px;
        }
        
        .move-badges {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            justify-content: center;
            margin-top: 4px;
        }
        
        
        .type-badge {
            padding: 3px 8px;
            border-radius: 999px;
            font-size: 11px;
            font-weight: 600;
            color: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
            line-height: 1;
        }
        
        
        .type-badge.type-bug     { background-color: #A8B820; color: white; }
        .type-badge.type-dark    { background-color: #705848; color: white; }
        .type-badge.type-dragon  { background-color: #7038F8; color: white; }
        .type-badge.type-electric{ background-color: #F8D030; color: #000; }
        .type-badge.type-fairy   { background-color: #EE99AC; color: white; }
        .type-badge.type-fighting{ background-color: #C03028; color: white; }
        .type-badge.type-fire    { background-color: #F08030; color: white; }
        .type-badge.type-flying  { background-color: #A890F0; color: #000; }
        .type-badge.type-ghost   { background-color: #705898; color: white; }
        .type-badge.type-grass   { background-color: #78C850; color: white; }
        .type-badge.type-ground  { background-color: #E0C068; color: white; }
        .type-badge.type-ice     { background-color: #98D8D8; color: #000; }
        .type-badge.type-normal  { background-color: #A8A878; color: #000; }
        .type-badge.type-poison  { background-color: #A040A0; color: white; }
        .type-badge.type-psychic { background-color: #F85888; color: white; }
        .type-badge.type-rock    { background-color: #B8A038; color: white; }
        .type-badge.type-steel   { background-color: #B8B8D0; color: #000; }
        .type-badge.type-water   { background-color: #6890F0; color: white; }
        
        .pokemonTypes {
            margin: 4px 0;
            font-size: 12px;
            font-weight: bold;
            display: flex;
            gap: 4px;
            justify-content: center;
        }
        
        .typeLabel {
            background-color: #eee;
            border-radius: 6px;
            padding: 2px 6px;
            font-size: 11px;
            color: #444;
        }
        
        .ivContainer {
            display: flex;
            justify-content: space-around;
            margin-top: 6px;
        }
        
        .ivBox {
            background-color: #f3f3f3;
            border-radius: 8px;
            padding: 4px 6px;
            width: 48px;
            text-align: center;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            font-size: 11px;
        }

        .ivLabel {
            font-weight: bold;
        }

        .ivEmoji {
            font-size: 14px;
            margin: 2px 0;
        }

        .ivValue {
            font-size: 13px;
            font-weight: bold;
        }
        
        
        .badge {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 12px;
            padding: 3px 6px;
            border-radius: 4px;
            color: white;
        }
        
        
        .sprite-container {
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 10px;
        }
        
        .sprite {
            max-height: 140px;
            max-width: 140px;
        }
        
        .pokemon-name {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 5px;
            color: var(--dark-color);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .pokemon-number {
            color: var(--muted-text);
            font-weight: bold;
			font-size: 14px;
            margin-bottom: 10px;
        }
        
        .pokemon-cp {
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 5px;
            color: var(--primary-color);
        }
        
        .stats {
            display: flex;
            justify-content: space-around;
            margin-top: 10px;
        }
        
        .stat {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .stat-value {
            font-weight: bold;
            color: var(--dark-color);
        }
        
        .stat-label {
            font-size: 10px;
            color: var(--muted-text);
        }
        
        .gender-male {
            color: #2196f3;
        }
        
        .gender-female {
            color: #e91e63;
        }
        
        .gender-neutral {
            color: #9e9e9e;
        }
        
        .move {
            font-size: 11px;
            color: #555;
            margin-top: 10px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .hidden {
            display: none !important;
        }
        
        /* Modal styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 10px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            display: flex;
            flex-direction: column;
        }
        
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #eee;
            position: sticky;
            top: 0;
            background-color: white;
            z-index: 10;
            border-radius: 10px 10px 0 0;
        }
        
        .modal-body {
            padding: 20px;
            overflow-y: auto;
        }
        
        .modal-footer {
            padding: 20px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: flex-end;
            position: sticky;
            bottom: 0;
            background-color: white;
            border-radius: 0 0 10px 10px;
        }
        
        .close-modal {
            position: absolute;
            right: 20px;
            top: 20px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #777;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .close-modal:hover {
            color: var(--primary-color);
        }
        
        .modal-details {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .detail-pokemon-info .pokemon-types {
            display: inline-flex;
            gap: 4px;
            flex-wrap: wrap;
        }
        
        .detail-pokemon-info .type-badge {
            font-size: 11px;
            padding: 3px 8px;
            border-radius: 999px;
            vertical-align: middle;
        }
        
        
        .detail-pokemon-sprite {
            text-align: center;
            flex: 1;
            min-width: 200px;
        }
        
        .detail-pokemon-sprite img {
            max-width: 200px;
            max-height: 200px;
        }
        
        .detail-pokemon-info {
            flex: 2;
            min-width: 300px;
        }
        
        .detail-section {
            margin-bottom: 20px;
        }
        
        .detail-section h3 {
            margin-bottom: 10px;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        
        .detail-stats {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .detail-stat-box {
            background-color: #f5f5f5;
            border-radius: 8px;
            padding: 10px;
            min-width: 80px;
            text-align: center;
        }
        
        .detail-moves {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .detail-move {
            background-color: #f5f5f5;
            border-radius: 8px;
            padding: 10px;
            min-width: 120px;
        }
        
        .detail-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .detail-table tr {
            border-bottom: 1px solid #eee;
        }
        
        .detail-table th, .detail-table td {
            padding: 8px;
            text-align: left;
        }
        
        .detail-table th {
            color: var(--muted-text);
            font-weight: normal;
            width: 40%;
        }
        
        .detail-table td {
            font-weight: 500;
        }
        
        .stat-bar-container {
            width: 100%;
            height: 6px;
            background-color: #eee;
            border-radius: 3px;
            margin-top: 5px;
        }
        
        .stat-bar {
            height: 100%;
            border-radius: 3px;
        }
        
        .stat-bar-attack {
            background-color: #ff5252;
        }
        
        .stat-bar-defence {
            background-color: #2196f3;
        }
        
        .stat-bar-stamina {
            background-color: #4caf50;
        }
        
        .progress-bar {
            border-radius: 5px;
            overflow: hidden;
            margin-top: 5px;
            background-color: #e0e0e0;
            height: 8px;
        }
        
        .progress-fill {
            height: 100%;
            background-color: var(--primary-color);
        }
        
        /* Responsive */
        @media (max-width: 600px) {
            .pokemon-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
            
            .stat-box {
                min-width: 100%;
            }
            
            .modal-content {
                width: 95%;
            }
        }
        
        /* Toggle switch */
        .toggle-container {
            display: flex;
            align-items: center;
        }
        
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
            margin-right: 10px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: var(--primary-color);
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        
        .toggle-label {
            font-size: 14px;
        }
        
        /* Loading spinner */
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: var(--primary-color);
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
        
        .load-more-container {
            text-align: center;
            margin-top: 20px;
        }
		.alpha-nav {
            position: fixed;
			top: 50%;
			right: 10px;
			transform: translateY(-50%);
			background: rgba(255,255,255,0.9);
			border-radius: 10px;
			padding: 5px;
			box-shadow: 0 0 5px rgba(0,0,0,0.1);
			z-index: 100;
		}
        
		.alpha-nav ul {
            list-style: none;
			padding: 0;
			margin: 0;
			text-align: center;
		}
        
		.alpha-nav li {
            padding: 4px 6px;
			cursor: pointer;
			font-weight: bold;
			font-size: 14px;
			color: var(--primary-color);
		}
        
		.alpha-nav li:hover {
            background-color: var(--light-color);
		}
        
        
        
        #stickySearchContainer {
            position: sticky;
            top: 0;
            background: white;
            z-index: 100;
            padding: 10px 0;
        }
        
        
        .pokemon-card[data-iv-percent] {
            position: relative;
            background-image: linear-gradient(
                to bottom,
                var(--iv-gradient-start),
                var(--iv-gradient-end)
                );
                background-blend-mode: multiply;
            }
            
/* Radio button styles */
.filter-radio-group {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 10px;
}

.filter-radio {
    display: none;
}

.filter-radio-label {
    padding: 6px 12px;
    border-radius: 4px;
    background-color: #f5f5f5;
    border: 1px solid #ccc;
    cursor: pointer;
    font-size: 14px;
    transition: background-color 0.2s ease;
}

.filter-radio:checked + .filter-radio-label {
    background-color: var(--primary-color);
    color: white;
}

.filter-radio-label:hover {
    background-color: #e0e0e0;
}

.filter-flash {
    background-color: #ff4d4d !important;
    transition: background-color 0.2s ease;
}

.filter-pill {
    padding: 5px 10px;
    margin: 3px;
    background-color: #f5f5f5;
    border: 1px solid #ccc;
    border-radius: 5px;
    cursor: pointer;
    color: #000;
}
.filter-pill.active {
    background-color: #e53935;
    color: #fff;
}
.filter-pill-label:hover {
    background-color: #e0e0e0;
}


/* Inline checkbox + dropdown group layout */
.inline-checkbox-group {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 6px;
    width: auto;
}

.tight-label {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    font-size: 14px;
    line-height: 1.2;
    white-space: nowrap;
}

.tight-label input[type="checkbox"] {
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    width: 16px;
    height: 16px;
    margin: 0;
    padding: 0;
    border: 2px solid #999;
    border-radius: 4px;
    background-color: white;
    cursor: pointer;
    position: relative;
    box-sizing: border-box;
}

/* Checkmark when checked */
.tight-label input[type="checkbox"]:checked::after {
    content: '';
    position: absolute;
    top: 2px;
    left: 5px;
    width: 4px;
    height: 8px;
    border: solid #333;
    border-width: 0 2px 2px 0;
    transform: rotate(45deg);
}










/* Shadow Pokemon - Darker purple aura with smoke effect */
.pokemon-card.shadow {
    position: relative;
    overflow: hidden;
    background: linear-gradient(135deg, #f5f5f5 0%, #e0e0e0 100%);
}

.pokemon-card.shadow::before {
    content: '';
    position: absolute;
    inset: -30%;
    background: radial-gradient(circle at 50% 50%, rgba(91, 15, 153, 0.35) 0%, transparent 70%);
    animation: pulseAura 3s infinite ease-in-out alternate, floatSmoke 25s infinite linear;
    z-index: 0;
    pointer-events: none;
    filter: blur(4px);
    opacity: 0.9;
}

    
    /* Shiny Pokemon - Fixed sparkle background with gradient */
    .pokemon-card.shiny {
        position: relative;
        overflow: hidden;
        background: linear-gradient(135deg, #2f00ff 0%, #992727 50%, #ddcb09 100%);
    }
    

    .pokemon-card.shiny::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-image: 
            radial-gradient(circle at 20% 30%, rgba(255, 255, 255, 0.9) 0%, transparent 25%),
            radial-gradient(circle at 80% 70%, rgba(255, 127, 255, 0.9) 0%, transparent 25%),
            radial-gradient(circle at 40% 80%, rgba(255, 255, 127, 0.9) 0%, transparent 25%),
            radial-gradient(circle at 60% 20%, rgba(127, 127, 255, 0.9) 0%, transparent 25%),
            radial-gradient(circle at 30% 60%, rgba(127, 127, 127, 0.9) 0%, transparent 25%),
            radial-gradient(circle at 70% 40%, rgba(64, 64, 64, 0.9) 0%, transparent 25%);
        z-index: 0;
        animation: twinkle 4.5s infinite;
    }

    .sparkles {
  position: relative;
  width: 100px;
  height: 100px;
  background-color: #fff;
  border-radius: 50%;
}

.sparkles::before,
.sparkles::after {
  content: "";
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 100%;
  height: 100%;
  background-image: radial-gradient(
    rgba(255, 255, 255, 1) 0%,
    rgba(255, 255, 255, 0.5) 20%,
    rgba(255, 255, 255, 0) 40%
  );
  background-size: 200% 200%;
  animation: sparkle 2s infinite;
}

.sparkles::after {
  animation-delay: 1s;
  background-image: radial-gradient(
    rgba(255, 215, 0, 1) 0%,
    rgba(255, 215, 0, 0.5) 20%,
    rgba(255, 215, 0, 0) 40%
  );
}

@keyframes sparkle {
  0% {
    transform: translate(-50%, -50%) scale(0.5);
    opacity: 0.5;
  }
  50% {
    transform: translate(-50%, -50%) scale(1.2);
    opacity: 1;
  }
  100% {
    transform: translate(-50%, -50%) scale(0.5);
    opacity: 0.5;
  }
}
    
    /* .pokemon-card.shiny::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-image: 
            radial-gradient(circle at 20% 30%, rgba(255, 255, 255, 0.9) 0%, transparent 25%),
            radial-gradient(circle at 80% 70%, rgba(255, 127, 255, 0.9) 0%, transparent 25%),
            radial-gradient(circle at 40% 80%, rgba(255, 255, 127, 0.9) 0%, transparent 25%),
            radial-gradient(circle at 60% 20%, rgba(127, 127, 255, 0.9) 0%, transparent 25%),
            radial-gradient(circle at 30% 60%, rgba(127, 127, 127, 0.9) 0%, transparent 25%),
            radial-gradient(circle at 70% 40%, rgba(64, 64, 64, 0.9) 0%, transparent 25%);
        z-index: 0;
        animation: twinkle 4.5s infinite;
    } */
    
    /* Lucky Pokemon - More dynamic golden clouds */
    .pokemon-card.lucky {
        position: relative;
        overflow: hidden;
        background: linear-gradient(135deg, #fff 0%, #fff 70%, #fff9c4 100%);
    }
    
    .pokemon-card.lucky::before,
    .pokemon-card.lucky::after {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        right: -50%;
        bottom: -50%;
        background: 
        radial-gradient(circle, rgba(255, 217, 0, 0.349) 0%, transparent 70%),
            url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200"><path fill="rgba(255, 215, 0, 0.3)" d="M30,30 Q50,10 70,30 T110,30 Q130,10 150,30 T190,30 Q210,10 230,30 T270,30 Q290,10 310,30 T350,30 Q370,10 390,30 T430,30 Q450,10 470,30 T510,30 Q530,10 550,30 T590,30 Q610,10 630,30 T670,30 Q690,10 710,30 T750,30 Q770,10 790,30 T830,30 Q850,10 870,30 T910,30 Q930,10 950,30 T990,30 Q1010,10 1030,30" transform="translate(-30,-30)"/></svg>');
        background-size: 200px 200px;
        z-index: 0;
        animation: floatCloud 20s infinite linear;
    }
    
    .pokemon-card.lucky::after {
        animation: floatCloudReverse 25s infinite linear;
        opacity: 0.7;
        background-position: 100px 100px;
    }
    
    /* Animations */
    @keyframes pulseAura {
        0% { opacity: 0.8; transform: scale(0.98); }
        100% { opacity: 1; transform: scale(1.02); }
    }
    
    @keyframes floatSmoke {
        0% { background-position: 0 0; }
        100% { background-position: 200px 200px; }
    }
    
    @keyframes twinkle {
        0%, 100% { opacity: 0.8; }
        50% { opacity: .2; }
    }
    
    @keyframes floatCloud {
        0% { 
            transform: translateX(0) translateY(0);
            background-position: 0 0;
        }
        25% { 
            transform: translateX(-20px) translateY(-15px);
            background-position: 50px 50px;
        }
        50% { 
            transform: translateX(0) translateY(-30px);
            background-position: 100px 100px;
        }
        75% { 
            transform: translateX(20px) translateY(-15px);
            background-position: 150px 150px;
        }
        100% { 
            transform: translateX(0) translateY(0);
            background-position: 200px 200px;
        }
    }
    
    @keyframes floatCloudReverse {
        0% { 
            transform: translateX(0) translateY(0);
            background-position: 200px 200px;
        }
        25% { 
            transform: translateX(15px) translateY(20px);
            background-position: 150px 150px;
        }
        50% { 
            transform: translateX(30px) translateY(0);
            background-position: 100px 100px;
        }
        75% { 
            transform: translateX(15px) translateY(-20px);
            background-position: 50px 50px;
        }
        100% { 
            transform: translateX(0) translateY(0);
            background-position: 0 0;
        }
    }
    
    /* Ensure content stays above backgrounds */
    .pokemon-card > * {
        position: relative;
        z-index: 1;
    }
</style>
</head>
<body>
    <h1>Pok√©mon GO Collection Viewer</h1>
    
    <div class="controls">
        <div class="control-section">
            <h3>File Operations</h3>
            <div class="filters-row">
                <button id="loadSampleData">Load Sample Data</button>
                <button id="uploadJsonBtn">Upload JSON File</button>
                <button id="exportSelectedBtn" class="secondary">Export Selected</button>
            </div>
        </div>
        
        <div class="control-section">
            <h3>Basic Filters</h3>
            <div class="filters-row">
                <select id="sortBy">
                    <option value="number">Sort by Pok√©dex #</option>
                    <option value="cp">Sort by CP</option>
                    <option value="name">Sort by Name</option>
                    <option value="attack">Sort by Attack</option>
                    <option value="defence">Sort by Defense</option>
                    <option value="stamina">Sort by Stamina</option>
                </select>

                
                
                <select id="filterStatus">
                    <option value="all">All Pok√©mon</option>
                    <option value="shiny">Shiny</option>
                    <option value="shadow">Shadow</option>
                    <option value="lucky">Lucky</option>
                </select>
                
<div style="display: flex; align-items: center; gap: 8px;">
  <input type="text" id="searchInput" placeholder="Search here...">
  <button id="searchHelpBtn" title="Search help" style="padding: 4px 8px; font-weight: bold; font-size: 16px; cursor: pointer;">?</button>
</div>
</div>
                
                <div class="filter-radio-group">
                    <input type="button" id="filterNone" class="filter-radio" value="None" onclick="clearSpecialFilters()">
                    <label for="filterNone" class="filter-radio-label" title="Clear all special filters">None</label>

                    <input type="checkbox" id="filterShiny" class="filter-radio" onchange="filterAndSortPokemon()">
                    <label for="filterShiny" class="filter-radio-label" title="Show only shiny Pok√©mon">Shinies</label>
                    
                    <input type="checkbox" id="filterLucky" class="filter-radio" onchange="filterAndSortPokemon()">
                    <label for="filterLucky" class="filter-radio-label" title="Show only lucky Pok√©mon">Luckys</label>
                    
                    <input type="checkbox" id="filterShadow" class="filter-radio" onchange="filterAndSortPokemon()">
                    <label for="filterShadow" class="filter-radio-label" title="Show only shadow Pok√©mon">Shadows</label>
                    
                    <input type="checkbox" id="filterPurified" class="filter-radio" onchange="filterAndSortPokemon()">
                    <label for="filterPurified" class="filter-radio-label" title="Show only purified Pok√©mon">Purified</label>
                    
                    <input type="checkbox" id="filterHundo" class="filter-radio" onchange="filterAndSortPokemon()">
                    <label for="filterHundo" class="filter-radio-label" title="Show only 100% IV Pok√©mon">Hundos</label>
                    
                    <input type="checkbox" id="filterNundo" class="filter-radio" onchange="filterAndSortPokemon()">
                    <label for="filterNundo" class="filter-radio-label" title="Show only 0% IV Pok√©mon">Nundos</label>
                    
                    <input type="checkbox" id="filterNickname" class="filter-radio" onchange="filterAndSortPokemon()">
                    <label for="filterNickname" class="filter-radio-label" title="Show only Pok√©mon with nicknames">Nicknames</label>
                    
                </div>
                
            </div>
            
            <div class="control-section">
                <h3>Advanced Filters</h3>
                <label for="filterRegion">Region:</label>
                <select id="filterRegion">
                  <option value="">All Regions</option>
                  <option value="Kanto">Kanto</option>
                  <option value="Johto">Johto</option>
                  <option value="Hoenn">Hoenn</option>
                  <option value="Sinnoh">Sinnoh</option>
                  <option value="Unova">Unova</option>
                  <option value="Kalos">Kalos</option>
                  <option value="Alola">Alola</option>
                  <option value="Galar">Galar</option>
                  <option value="Hisui">Hisui</option>
                  <option value="Paldea">Paldea</option>
                </select>
                <div class="filters-row">
                    
                <!-- Type Badges filtering -->
                <button id="clear-type-filters" class="clear-type-button">Clear Type Filters</button>
                <div id="type-filter" class="type-filter-grid"></div>

                <!-- Move dropdown filtering -->
                <div style="display: flex; align-items: center; gap: 8px;">
                    <select id="filterFastMove" onclick="updateFastMoveDropdown()">
                        <option value="">Fast Moves</option>
                  </select>

                <button id="toggleMoveLink" title="Toggle move filter linking"
                    style="font-size: 20px; background: none; border: none; cursor: pointer;">üîÉ</button>

                    <select id="filterChargedMove" onclick="updateChargedMoveDropdown()">
                        <option value="">Charged Moves</option>
                  </select>
                </div>

                  
                
                <div style="display: flex; align-items: center; gap: 8px;">
                    <select id="filterGender" style="height: 36px; padding: 4px 8px; font-size: 14px;">
                        <option value="">Any Gender</option>
                        <option value="MALE">Male</option>
                        <option value="FEMALE">Female</option>
                        <option value="GENDERLESS">Genderless</option>
                    </select>
                  </div>
                  

                
                <!-- Special Forms filtering -->
                <div class="inline-checkbox-group">
                    <button type="button" id="filterAltFormsOnly" class="filter-pill" onclick="toggleFilterState(this, 'AltFormsOnly')">All Forms</button>
                    <select id="filterForm">
                        <option value="">Forms</option>
                    </select>
                </div>
                
                <div class="inline-checkbox-group">
                    <button type="button" id="filterCostumedOnly" class="filter-pill" onclick="toggleFilterState(this, 'CostumedOnly')">All Costumes</button>
                    <select id="filterCostume">
                        <option value="">Costumes</option>
                    </select>
                </div>
                

            </div>
            
            <div class="filters-row">
                <div class="toggle-container">
                    <label class="switch">
                        <input type="checkbox" id="toggleAdvancedFilters">
                        <span class="slider"></span>
                    </label>
                    <span class="toggle-label">Show Stat Filters</span>
                </div>
            </div>
            
            <div id="advancedFiltersContainer" class="hidden">
                <div class="filters-row">
                    <div style="display: flex; flex-direction: column; min-width: 150px;">
                        <label for="cpMin">CP Range:</label>
                        <div style="display: flex; gap: 5px;">
                            <input type="number" id="cpMin" placeholder="Min" style="min-width: 70px; width: 70px;">
                            <input type="number" id="cpMax" placeholder="Max" style="min-width: 70px; width: 70px;">
                        </div>
                    </div>
                    
                    <div style="display: flex; flex-direction: column; min-width: 150px;">
                        <label for="attackMin">Attack IV:</label>
                        <div style="display: flex; gap: 5px;">
                            <input type="number" id="attackMin" placeholder="Min" min="0" max="15" style="min-width: 70px; width: 70px;">
                            <input type="number" id="attackMax" placeholder="Max" min="0" max="15" style="min-width: 70px; width: 70px;">
                        </div>
                    </div>
                    
                    <div style="display: flex; flex-direction: column; min-width: 150px;">
                        <label for="defenceMin">Defense IV:</label>
                        <div style="display: flex; gap: 5px;">
                            <input type="number" id="defenceMin" placeholder="Min" min="0" max="15" style="min-width: 70px; width: 70px;">
                            <input type="number" id="defenceMax" placeholder="Max" min="0" max="15" style="min-width: 70px; width: 70px;">
                        </div>
                    </div>
                    
                    <div style="display: flex; flex-direction: column; min-width: 150px;">
                        <label for="staminaMin">Stamina IV:</label>
                        <div style="display: flex; gap: 5px;">
                            <input type="number" id="staminaMin" placeholder="Min" min="0" max="15" style="min-width: 70px; width: 70px;">
                            <input type="number" id="staminaMax" placeholder="Max" min="0" max="15" style="min-width: 70px; width: 70px;">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="stats-container" id="statsContainer">
        <div class="stat-box">
            <div class="stat-value" id="totalPokemon">0</div>
            <div class="stat-label">                Total Pok√©mon <span id="totalStatLabelSuffix" style="font-weight: normal;"></span>
            </div>
        </div>
        <div class="stat-box">
            <div class="stat-value" id="uniquePokemon">0</div>
            <div class="stat-label">                Unique Pok√©mon<span id="uniqueStatLabelSuffix" style="font-weight: normal;"></span>
            </div>
        </div>
        <div class="stat-box shiny-stat">
            <div class="stat-value" id="shinyCount">0</div>
            <div class="stat-label">                Shiny <span id="shinyStatLabelSuffix" style="font-weight: normal;"></span>

            </div>        </div>
        <div class="stat-box shadow-stat">
            <div class="stat-value" id="shadowCount">0</div>
            <div class="stat-label">                Shadow <span id="shadowStatLabelSuffix" style="font-weight: normal;"></span>

            </div>        </div>
        <div class="stat-box lucky-stat">
            <div class="stat-value" id="luckyCount">0</div>
            <div class="stat-label">                Lucky <span id="luckyStatLabelSuffix" style="font-weight: normal;"></span>

            </div>        </div>
        <div class="stat-box">
            <div class="stat-value" id="avgCp">0</div>
            <div class="stat-label">                CP <span id="cpStatLabelSuffix" style="font-weight: normal;"></span>

            </div>        </div>
        <div class="stat-box">
            <div class="stat-value" id="avgIv">0%</div>
            <div class="stat-label">                IV <span id="ivStatLabelSuffix" style="font-weight: normal;"></span>

            </div>
            </div>
    </div>
    
    <div class="selection-tools">
        <h3>Selection Tools</h3>
        <div class="filters-row">
            <button id="selectAllBtn">Select All Visible</button>
            <button id="deselectAllBtn">Deselect All</button>
            <span id="selectedCount" style="margin-left: auto;">0 selected</span>
        </div>
    </div>

    
    <div id="pokemonGrid" class="pokemon-grid">
        <!-- Pok√©mon cards will be inserted here -->
    </div>
    
    <div class="load-more-container">
        <button id="loadMoreBtn" class="hidden">Load More</button>
    </div>
    
    <!-- Modal for detailed Pok√©mon view -->
    <div id="pokemonModal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Pok√©mon Details</h2>
                <button class="close-modal" id="closeModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="modal-details" id="modalDetails">
                    <!-- Details will be inserted here -->
                </div>
            </div>
            <div class="modal-footer">
                <button id="closeModalBtn">Close</button>
            </div>
        </div>
    </div>

    <script>
        console.log("Script loaded");

document.getElementById('searchHelpBtn').addEventListener('click', () => {
    document.getElementById('searchHelpModal').classList.remove('hidden');
});

function closeSearchHelpModal() {
    document.getElementById('searchHelpModal').classList.add('hidden');
}


        function toggleFilterState(button, filterKey) {
        button.classList.toggle('active');
        // Simulate internal checkbox state (if needed elsewhere)
        window[`filter${filterKey}State`] = button.classList.contains('active');
        filterAndSortPokemon();
    }

        
    // Global variables
let pokemonData = {};
let filteredPokemonIds = [];
let selectedPokemonIds = new Set();
let allMoves = new Set();
let allForms = new Set();
let allCostumes = new Set();
let displayLimit = 50;
let currentlyDisplayed = 0;
let masterUrl = "";
let moveDropdownsLinked = true;


// --- Master Typings Inline ---
let pokeTypings = {
    "BUG": [10, 11, 12, 13, 14, 15, 46, 47, 48, 49, 123, 127, 165, 166, 167, 168, 193, 204, 205, 212, 213, 214, 265, 266, 267, 268, 269, 283, 284, 290, 291, 292, 313, 314, 347, 348, 401, 402, 412, 413, 414, 415, 416, 451, 469, 540, 541, 542, 543, 544, 545, 557, 558, 588, 589, 595, 596, 616, 617, 632, 636, 637, 649, 664, 665, 666, 736, 737, 738, 742, 743, 751, 752, 767, 768, 794, 795, 824, 825, 826, 850, 851, 872, 873, 900, 917, 918, 919, 920, 953, 954, 988],
    "DARK": [19, 20, 52, 53, 88, 89, 146, 197, 198, 211, 215, 228, 229, 248, 261, 262, 263, 264, 274, 275, 302, 318, 319, 332, 342, 359, 430, 434, 435, 442, 452, 461, 491, 503, 509, 510, 551, 552, 553, 559, 560, 570, 571, 624, 625, 629, 630, 633, 634, 635, 658, 675, 686, 687, 717, 720, 727, 799, 827, 828, 859, 860, 861, 862, 877, 892, 893, 904, 908, 920, 942, 943, 962, 983, 986, 993, 1001, 1002, 1003, 1004, 1005],
    "DRAGON": [103, 147, 148, 149, 230, 329, 330, 334, 371, 372, 373, 380, 381, 384, 443, 444, 445, 483, 484, 487, 610, 611, 612, 621, 633, 634, 635, 643, 644, 646, 691, 696, 697, 704, 705, 706, 714, 715, 718, 776, 780, 782, 783, 784, 799, 800, 804, 840, 841, 842, 880, 882, 884, 885, 886, 887, 890, 895, 967, 978, 996, 997, 998, 1005, 1007, 1008, 1009, 1011, 1018, 1019, 1020, 1021],
    "ELECTRIC": [25, 26, 74, 75, 76, 81, 82, 100, 101, 125, 135, 145, 170, 171, 172, 179, 180, 181, 239, 243, 309, 310, 311, 312, 403, 404, 405, 417, 462, 466, 479, 522, 523, 587, 595, 596, 602, 603, 604, 618, 642, 644, 694, 695, 702, 737, 738, 741, 777, 785, 796, 807, 835, 836, 848, 849, 871, 877, 880, 881, 894, 921, 922, 923, 938, 939, 940, 941, 989, 992, 995, 1008, 1021],
    "FAIRY": [35, 36, 38, 39, 40, 78, 110, 122, 173, 174, 175, 176, 183, 184, 209, 210, 280, 281, 282, 298, 303, 439, 468, 546, 547, 669, 670, 671, 682, 683, 684, 685, 700, 702, 703, 707, 716, 719, 730, 742, 743, 755, 756, 764, 778, 785, 786, 787, 788, 801, 858, 859, 860, 861, 868, 869, 888, 905, 926, 927, 957, 958, 959, 985, 987, 1006, 1016],
    "FIGHTING": [56, 57, 62, 66, 67, 68, 83, 106, 107, 128, 145, 214, 215, 236, 237, 256, 257, 286, 296, 297, 307, 308, 391, 392, 447, 448, 453, 454, 475, 499, 500, 532, 533, 534, 538, 539, 549, 559, 560, 619, 620, 638, 639, 640, 647, 648, 652, 674, 675, 701, 724, 739, 740, 759, 760, 766, 783, 784, 794, 795, 802, 852, 853, 865, 870, 889, 891, 892, 903, 914, 922, 923, 973, 979, 984, 988, 992, 1006, 1007, 1014],
    "FIRE": [4, 5, 6, 37, 38, 58, 59, 77, 78, 105, 126, 128, 136, 146, 155, 156, 157, 218, 219, 228, 229, 240, 244, 250, 255, 256, 257, 322, 323, 324, 351, 383, 390, 391, 392, 467, 479, 485, 494, 498, 499, 500, 513, 514, 554, 555, 607, 608, 609, 631, 636, 637, 643, 653, 654, 655, 662, 663, 667, 668, 721, 725, 726, 727, 741, 757, 758, 776, 806, 813, 814, 815, 838, 839, 850, 851, 909, 910, 911, 935, 936, 937, 952, 994, 1004, 1017, 1020],
    "FLYING": [6, 12, 16, 17, 18, 21, 22, 41, 42, 83, 84, 85, 123, 130, 142, 144, 145, 146, 149, 163, 164, 165, 166, 169, 176, 177, 178, 187, 188, 189, 193, 198, 207, 225, 226, 227, 249, 250, 267, 276, 277, 278, 279, 284, 291, 333, 334, 357, 373, 384, 396, 397, 398, 414, 415, 416, 425, 426, 430, 441, 458, 468, 469, 472, 479, 492, 519, 520, 521, 527, 528, 561, 566, 567, 580, 581, 587, 627, 628, 629, 630, 641, 642, 645, 661, 662, 663, 666, 701, 714, 715, 717, 722, 723, 731, 732, 733, 741, 774, 797, 821, 822, 823, 845, 905, 931, 940, 941, 962, 973, 993],
    "GHOST": [92, 93, 94, 105, 157, 200, 222, 292, 302, 353, 354, 355, 356, 425, 426, 429, 442, 477, 478, 479, 487, 562, 563, 570, 571, 592, 593, 607, 608, 609, 622, 623, 679, 680, 681, 708, 709, 710, 711, 720, 724, 741, 769, 770, 778, 781, 792, 800, 802, 806, 854, 855, 864, 867, 885, 886, 887, 897, 898, 902, 911, 937, 946, 947, 971, 972, 979, 987, 999, 1000, 1012, 1013, 1025],
    "GRASS": [1, 2, 3, 43, 44, 45, 46, 47, 69, 70, 71, 101, 102, 103, 114, 152, 153, 154, 182, 187, 188, 189, 191, 192, 251, 252, 253, 254, 270, 271, 272, 273, 274, 275, 285, 286, 315, 331, 332, 345, 346, 357, 387, 388, 389, 406, 407, 413, 420, 421, 455, 459, 460, 465, 470, 479, 492, 495, 496, 497, 511, 512, 540, 541, 542, 546, 547, 548, 549, 556, 585, 586, 590, 591, 597, 598, 640, 650, 651, 652, 672, 673, 708, 709, 710, 711, 722, 723, 724, 753, 754, 755, 756, 761, 762, 763, 781, 787, 798, 810, 811, 812, 829, 830, 840, 841, 842, 893, 898, 906, 907, 908, 928, 929, 930, 946, 947, 948, 949, 951, 952, 986, 1001, 1010, 1011, 1012, 1013, 1017, 1019],
    "GROUND": [27, 28, 31, 34, 50, 51, 74, 75, 76, 95, 104, 105, 111, 112, 194, 195, 207, 208, 220, 221, 231, 232, 246, 247, 259, 260, 290, 322, 323, 328, 329, 330, 339, 340, 343, 344, 383, 389, 413, 423, 443, 444, 445, 449, 450, 464, 472, 473, 529, 530, 536, 537, 551, 552, 553, 562, 618, 622, 623, 645, 660, 718, 749, 750, 769, 770, 843, 844, 867, 901, 948, 949, 980, 984, 989, 990, 1003],
    "ICE": [27, 28, 37, 38, 87, 91, 122, 124, 131, 144, 215, 220, 221, 225, 238, 351, 361, 362, 363, 364, 365, 378, 459, 460, 461, 471, 473, 478, 479, 554, 555, 582, 583, 584, 613, 614, 615, 646, 698, 699, 712, 713, 740, 866, 872, 873, 875, 881, 883, 896, 898, 974, 975, 991, 996, 997, 998, 1002],
    "NORMAL": [16, 17, 18, 19, 20, 21, 22, 39, 40, 52, 53, 83, 84, 85, 108, 113, 115, 128, 132, 133, 137, 143, 161, 162, 163, 164, 174, 190, 203, 206, 216, 217, 233, 234, 235, 241, 242, 263, 264, 276, 277, 287, 288, 289, 293, 294, 295, 298, 300, 301, 327, 333, 335, 351, 352, 396, 397, 398, 399, 400, 424, 427, 428, 431, 432, 440, 441, 446, 463, 474, 486, 493, 504, 505, 506, 507, 508, 519, 520, 521, 531, 570, 571, 572, 573, 585, 586, 626, 627, 628, 648, 659, 660, 661, 667, 668, 676, 694, 695, 731, 732, 733, 734, 735, 759, 760, 765, 772, 773, 775, 780, 819, 820, 831, 832, 862, 876, 899, 901, 915, 916, 924, 925, 928, 929, 930, 931, 944, 945, 967, 981, 982, 1024],
    "POISON": [1, 2, 3, 13, 14, 15, 23, 24, 29, 30, 31, 32, 33, 34, 41, 42, 43, 44, 45, 48, 49, 69, 70, 71, 72, 73, 80, 88, 89, 92, 93, 94, 109, 110, 167, 168, 169, 194, 199, 211, 215, 269, 315, 316, 317, 336, 406, 407, 434, 435, 451, 452, 453, 454, 543, 544, 545, 568, 569, 590, 591, 690, 691, 747, 748, 757, 758, 793, 803, 804, 848, 849, 890, 903, 904, 944, 945, 965, 966, 969, 970, 980, 994, 1014, 1015, 1016, 1025],
    "PSYCHIC": [26, 63, 64, 65, 77, 78, 79, 80, 96, 97, 102, 103, 121, 122, 124, 144, 150, 151, 177, 178, 196, 199, 201, 202, 203, 238, 249, 251, 280, 281, 282, 307, 308, 325, 326, 337, 338, 343, 344, 358, 360, 374, 375, 376, 380, 381, 385, 386, 433, 436, 437, 439, 475, 480, 481, 482, 488, 494, 517, 518, 527, 528, 555, 561, 574, 575, 576, 577, 578, 579, 605, 606, 628, 648, 655, 677, 678, 686, 687, 720, 741, 765, 779, 786, 789, 790, 791, 792, 800, 825, 826, 856, 857, 858, 866, 876, 898, 899, 936, 954, 955, 956, 976, 981, 985, 1010, 1015, 1022, 1023],
    "ROCK": [58, 59, 74, 75, 76, 95, 111, 112, 138, 139, 140, 141, 142, 185, 213, 219, 222, 246, 247, 248, 299, 304, 305, 306, 337, 338, 345, 346, 347, 348, 369, 377, 408, 409, 410, 411, 438, 464, 476, 524, 525, 526, 557, 558, 564, 565, 566, 567, 639, 688, 689, 696, 697, 698, 699, 703, 713, 719, 744, 745, 774, 793, 805, 834, 837, 838, 839, 874, 900, 932, 933, 934, 950, 969, 970, 995, 1017, 1022],
    "STEEL": [27, 28, 50, 51, 52, 81, 82, 205, 208, 212, 227, 303, 304, 305, 306, 374, 375, 376, 379, 385, 395, 410, 411, 413, 436, 437, 448, 462, 476, 483, 485, 530, 589, 597, 598, 599, 600, 601, 618, 624, 625, 632, 638, 649, 679, 680, 681, 705, 706, 707, 777, 791, 797, 798, 800, 801, 805, 808, 809, 823, 863, 878, 879, 884, 888, 889, 957, 958, 959, 965, 966, 968, 983, 990, 1000, 1018, 1023],
    "WATER": [7, 8, 9, 54, 55, 60, 61, 62, 72, 73, 79, 80, 86, 87, 90, 91, 98, 99, 116, 117, 118, 119, 120, 121, 128, 129, 130, 131, 134, 138, 139, 140, 141, 158, 159, 160, 170, 171, 183, 184, 186, 194, 195, 199, 211, 222, 223, 224, 226, 230, 245, 258, 259, 260, 270, 271, 272, 278, 279, 283, 318, 319, 320, 321, 339, 340, 341, 342, 349, 350, 351, 363, 364, 365, 366, 367, 368, 369, 370, 382, 393, 394, 395, 400, 418, 419, 422, 423, 456, 457, 458, 479, 484, 489, 490, 501, 502, 503, 515, 516, 535, 536, 537, 550, 564, 565, 580, 581, 592, 593, 594, 647, 656, 657, 658, 688, 689, 690, 692, 693, 721, 728, 729, 730, 746, 747, 748, 751, 752, 767, 768, 771, 779, 788, 816, 817, 818, 833, 834, 845, 846, 847, 882, 883, 892, 902, 912, 913, 914, 960, 961, 963, 964, 976, 977, 978, 991, 1009, 1017]
    };

let specialSearchOptions = {
    "BABY": [172,173,174,175,236,238,239,240,298,360,406,433,438,439,440,446,447,458],
    "LEGENDARY": [144,145,146,150,243,244,245,249,250,377,378,379,380,381,382,383,384,480,481,482,483,484,485,486,487,488,493,638,639,640,641,642,643,644,645,646,716,717,718,772,773,785,786,787,789,790,791,792,800,888,889,890,891,892,894,895,898,905,1001,1002,1003,1004,1007,1008,1009,1010,1014,1015,1016,1017,1020,1021,1022,1023,1024],
    "MYTHICAL": [151,251,385,386,489,490,491,492,494,647,648,649,719,720,721,801,802,807,808,809,893,1025],
    "STAGEONE": [1,4,7,10,13,16,19,21,23,25,27,29,32,35,37,39,41,43,46,48,50,52,54,56,58,60,63,66,69,72,74,77,79,81,83,84,86,88,90,92,95,96,98,100,102,104,106,107,108,109,111,113,114,115,116,118,120,122,123,124,125,126,127,128,129,131,132,133,137,138,140,142,143,144,145,146,147,150,151,152,155,158,161,163,165,167,170,175,177,179,185,187,190,191,193,194,198,200,201,203,204,206,207,209,211,213,214,215,216,218,220,222,223,225,226,227,228,231,234,235,237,241,243,244,245,246,249,250,251,252,255,258,261,263,265,270,273,276,278,280,283,285,287,290,293,296,298-300,302-304,307,309,311,312,313,314,316,318,320,322,324,325,327,328,331,333,335,336,337,338,339,341,343,345,347,349,351,352,353,355,357,359-361,363,366,369,370,371,374,377,387,390,393,396,399,401,403,406,408,410,412,415,417,418,420,422,425,427,431,433,434,436,441-443,447,449,451,453,455,456,459,479,480,481,482,483,484,485,486,487,488,489,490,491,492,493,494,495,498,501,504,506,509,511,513,515,517,519,522,524,527,529,531,532,535,538,539,540,543,546,548,550,551,554,556,557,559,561,562,564,566,568,570,572,574,577,580,582,585,587,588,590,592,594,595,597,599,602,605,607,610,613,615,616,618,619,621,622,624,626,627,629,631,633,636,638,639,640,641,642,643,644,645,646,647,648,649,650,653,656,659,661,664,667,669,672,674,676,677,679,682,684,686,688,690,692,694,696,698,701,702,703,704,707,708,710,712,714,716,717,718,719,720,721,722,725,728,731,734,736,739,741,742,744,746,747,749,751,753,755,757,759,761,764,765,766,767,769,771,772,774,775,776,777,778,779,780,781,782,785,786,787,788,789,793,794,795,796,797,798,799,800,801,802,803,805,806,807,808,810,813,816,819,821,824,827,829,831,833,835,837,840,843,845,846,848,850,852,854,856,859,868,870,871,872,874,875,876,877,878,880,881,882,883,884,885,888,889,890,891,893,894,895,896,897,898,905,906,909,912,915,917,919,921,924,926,928,931,932,935,938,940,942,944,946,948,950,951,953,955,957,960,962,963,965,967,968,969,971,973,974,976,977,978,984,985,986,987,988,989,990,991,992,993,994,995,996,999,1001,1002,1003,1004,1005,1006,1007,1008,1009,1010,1012,1014,1015,1016,1017,1020,1021,1022,1023,1024,1025],
    "STAGETWO": [2,5,8,11,14,17,20,22,24,26,28,30,33,36,38,40,42,44,47,49,51,53,55,57,59,61,64,67,70,73,75,78,80,82,85,87,89,91,93,97,99,101,103,105,110,112,117,119,121,130,134-136,139,141,148,153,156,159,162,164,166,168,171,176,178,180,183,188,192,195,196,197,199,202,205,208,210,212,217,219,221,224,229,232-233,242,247,253,256,259,262,264,266,268,271,274,277,279,281,284,286,288,291,292,294,297,301,305,308,310,315,317,319,321,323,326,329,332,334,340,342,344,346,348,350,354,356,358,362,364,367,368,372,375,388,391,394,397,400,402,404,409,411,413,414,416,419,421,423,424,426,428,429,430,432,435,437,444,448,450,452,454,457,460-461,463,465,466,467,469-472,476,478,496,499,502,505,507,510,512,514,516,518,520,523,525,528,530,533,536,541,544,547,549,552,555,558,560,563,565,567,569,571,573,575,578,581,583,586,589,591,593,596,598,600,603,606,608,611,614,617,620,623,625,628,630,634,637,651,654,657,660,662,665,668,670,673,675,678,680,683,685,687,689,691,693,695,697,699,700,705,709,711,713,715,723,726,729,732,735,737,740,743,745,748,750,752,754,756,758,760,762,768,770,773,783,790,804,809,811,814,817,820,822,825,828,830,832,834,836,838,841,842,844,847,849,851,853,855,857,860,863-867,869,873,879,886,892,899,900,902,903,904,907,910,913,916,918,920,922,925,927,929,933,936,937,939,941,943,945,947,949,952,954,956,958,961,964,966,970,972,975,980,981,982,997,1000,1011,1013,1018],
    "STAGETHREE": [3,6,9,12,15,18,31,34,45,62,65,68,71,76,94,149,154,157,160,169,181,182,184,186,189,230,248,254,257,260,267,269,272,275,282,289,295,306,330,365,373,376,389,392,395,398,405,407,445,462,464,468,473-475,477,497,500,503,508,521,526,534,537,542,545,553,576,579,584,601,604,609,612,635,652,655,658,663,666,671,681,706,724,727,730,733,738,763,784,791-792,812,815,818,823,826,839,858,861-862,887,901,908,911,914,923,930,934,959,979,983,998,1019],
    "STARTERS": [1,2,3,4,5,6,7,8,9,152,153,154,155,156,157,158,159,160,252,253,254,255,256,257,258,259,260,387,388,389,390,391,392,393,394,395,495,496,497,498,499,500,501,502,503,650,651,652,653,654,655,656,657,658,722,723,724,725,726,727,728,729,730,810,811,812,813,814,815,816,817,818,906,907,908,909,910,911,912,913,914],
    "TRADEEVOLVE": [64,67,75,93,525,533,588,616,708,710]
}
let moveTypings = {
    "BUG": ["BUG_BITE_FAST", "FURY_CUTTER_FAST", "INFESTATION_FAST", "STRUGGLE_BUG_FAST",
                "BUG_BUZZ", "FELL_STINGER", "LUNGE", "MEGAHORN", "SIGNAL_BEAM", "SILVER_WIND", "X_SCISSOR"],
    "DARK": ["BITE_FAST", "FEINT_ATTACK_FAST", "SNARL_FAST", "SUCKER_PUNCH_FAST",
                "BRUTAL_SWING", "CRUNCH", "DARKEST_LARIAT", "DARK_PULSE", "FOUL_PLAY", "NIGHT_SLASH", "OBSTRUCT", "PAYBACK", "BADDY_BAD"],
    "DRAGON": ["DRAGON_BREATH_FAST", "DRAGON_TAIL_FAST",
                "BREAKING_SWIPE", "DRACO_METEOR", "DRAGON_CLAW", "DRAGON_PULSE", "OUTRAGE", "ROAR_OF_TIME", "SPACIAL_REND", "TWISTER"],
    "ELECTRIC": ["CHARGE_BEAM_FAST", "SPARK_FAST", "THUNDER_FANG_FAST", "THUNDER_SHOCK_FAST", "VOLT_SWITCH_FAST",
                    "AURA_WHEEL", "DISCHARGE", "FUSION_BOLT", "PARABOLIC_CHARGE", "TECHNO_BLAST_SHOCK", "THUNDER", "THUNDERBOLT", "THUNDER_PUNCH", "VOLT_TACKLE", "WILD_CHARGE", "WILDBOLT_STORM", "ZAP_CANNON"],
    "FAIRY": ["CHARM_FAST", "FAIRY_WIND_FAST", "GEOMANCY_FAST",
                "DAZZLING_GLEAM", "DISARMING_VOICE", "DRAINING_KISS", "MOONBLAST", "NATURES_MADNESS", "PLAY_ROUGH", "SPRINGTIDE_STORM"],
    "FIGHTING": ["COUNTER_FAST", "DOUBLE_KICK_FAST", "FORCE_PALM_FAST", "KARATE_CHOP_FAST", "LOW_KICK_FAST", "ROCK_SMASH_FAST",
                    "AURA_SPHERE", "BRICK_BREAK", "CLOSE_COMBAT", "CROSS_CHOP", "DRAIN_PUNCH", "DYNAMIC_PUNCH", "FLYING_PRESS", "FOCUS_BLAST", "HIGH_JUMP_KICK", "LOW_SWEEP", "POWER_UP_PUNCH", "SACRED_SWORD", "SUBMISSION", "SUPER_POWER", "UPPER_HAND"],
    "FIRE": ["EMBER_FAST", "FIRE_FANG_FAST", "FIRE_SPIN_FAST", "INCINERATE_FAST",
                "BLAST_BURN", "BLAZE_KICK", "FIRE_BLAST", "FIRE_PUNCH", "FLAME_BURST", "FLAME_CHARGE", "FLAME_WHEEL", "FLAMETHROWER", "FUSION_FLARE", "HEAT_WAVE", "MAGMA_STORM", "MYSTICAL_FIRE", "OVERHEAT", "SACRED_FIRE", "TECHNO_BLAST_BURN", "TORCH_SONG", "V_CREATE", "WEATHER_BALL_FIRE"],
    "FLYING": ["AIR_SLASH_FAST", "PECK_FAST", "GUST_FAST", "WING_ATTACK_FAST",
                "ACROBATICS", "AERIAL_ACE", "AEROBLAST", "AIR_CUTTER", "BLEAKWIND_STORM", "BRAVE_BIRD", "DRAGON_ASCENT", "DRILL_PECK", "FEATHER_DANCE", "FLY", "HURRICANE", "OBLIVION_WING", "SKY_ATTACK"],
    "GHOST": ["ASTONISH_FAST", "HEX_FAST", "LICK_FAST", "SHADOW_CLAW_FAST",
                "MOON_GEIST_BEAM", "NIGHT_SHADE", "OMINOUS_WIND", "POLTERGEIST", "RAGE_FIST", "SHADOW_BALL", "SHADOW_BONE", "SHADOW_FORCE", "SHADOW_PUNCH", "SHADOW_SNEAK", "SPIRIT_SHACKLE"],
    "GRASS": ["BULLET_SEED_FAST", "LEAFAGE_FAST", "MAGICAL_LEAF_FAST", "RAZOR_LEAF_FAST", "VINE_WHIP_FAST",
                "ENERGY_BALL", "FLOWER_TRICK", "FRENZY_PLANT", "GIGA_DRAIN", "GRASS_KNOT", "LEAF_BLADE", "LEAF_STORM", "LEAF_TORNADO", "MEGA_DRAIN", "PETAL_BLIZZARD", "POWER_WHIP", "SEED_BOMB", "SEED_FLARE", "SOLAR_BEAM", "TRAILBLAZE"],
    "GROUND": ["MUD_SHOT_FAST", "MUD_SLAP_FAST", "SAND_ATTACK_FAST",
                "BONE_CLUB", "BULLDOZE", "DIG", "DRILL_RUN", "EARTH_POWER", "EARTHQUAKE", "HIGH_HORSEPOWER", "MUD_BOMB", "PRECIPICE_BLADES", "SAND_TOMB", "SANDSEAR_STORM", "SCORCHING_SANDS"],
    "ICE": ["FROST_BREATH_FAST", "ICE_FANG_FAST", "ICE_SHARD_FAST", "POWDER_SNOW_FAST",
                "AURORA_BEAM", "AVALANCHE", "BLIZZARD", "FREEZE_SHOCK", "GLACIATE", "ICE_BEAM", "ICE_BURN", "ICE_PUNCH", "ICICLE_SPEAR", "ICY_WIND", "TECHNO_BLAST_CHILL", "TRIPLE_AXEL", "WEATHER_BALL_ICE"],
    "NORMAL": ["CUT_FAST", "HIDDEN_POWER_FAST", "LOCK_ON_FAST", "POUND_FAST", "PRESENT_FAST", "QUICK_ATTACK_FAST", "SCRATCH_FAST", "TACKLE_FAST", "TAKE_DOWN_FAST", "YAWN_FAST",
                "BODY_SLAM", "BOOMBURST", "FRUSTRATION", "GIGA_IMPACT", "HORN_ATTACK", "HYPER_BEAM", "LAST_RESORT", "REST", "RETURN", "SKULL_BASH", "STOMP", "STRUGGLE", "SWIFT", "TECHNO_BLAST_NORMAL", "TRI_ATTACK", "VISE_GRIP", "WRAP"],
    "POISON": ["ACID_FAST", "POISON_JAB_FAST", "POISON_STING_FAST",
                "ACID_SPRAY", "CROSS_POISON", "GUNK_SHOT", "POISON_FANG", "SLUDGE", "SLUDGE_BOMB", "SLUDGE_WAVE"],
    "PSYCHIC": ["CONFUSION_FAST", "EXTRASENSORY_FAST", "PSYCHO_CUT_FAST", "PSYWAVE_FAST", "ZEN_HEADBUTT_FAST",
                "FUTURE_SIGHT", "HEART_STAMP", "LUSTER_PURGE", "MIRROR_COAT", "MIST_BALL", "PSYBEAM", "PSYCHIC", "PSYCHIC_FANGS", "PSYCHO_BOOST", "PSYSHOCK", "PSYSTRIKE", "SYNCHRONOISE"],
    "ROCK": ["ROCK_THROW_FAST", "ROLLOUT_FAST", "SMACK_DOWN_FAST",
                "ANCIENT_POWER", "METEOR_BEAM", "POWER_GEM", "ROCK_BLAST", "ROCK_SLIDE", "ROCK_TOMB", "ROCK_WRECKER", "STONE_EDGE", "WEATHER_BALL_ROCK"],
    "STEEL": ["BULLET_PUNCH_FAST", "IRON_TAIL_FAST", "METAL_CLAW_FAST", "METAL_SOUND_FAST", "STEEL_WING_FAST",
                "BEHEMOTH_BASH", "BEHEMOTH_BLADE", "DOOM_DESIRE", "DOUBLE_IRON_BASH", "FLASH_CANNON", "GYRO_BALL", "HEAVY_SLAM", "IRON_HEAD", "MAGNET_BOMB", "METEOR_MASH", "MIRROR_SHOT", "SUNSTEEL_STRIKE"],
    "WATER": ["BUBBLE_FAST", "SPLASH_FAST", "WATER_GUN_FAST", "WATER_SHURIKEN_FAST", "WATERFALL_FAST",
                "AQUA_JET", "AQUA_TAIL", "BRINE", "BUBBLE_BEAM", "CRABHAMMER", "HYDRO_CANNON", "HYDRO_PUMP", "LIQUIDATION", "MUDDY_WATER", "OCTAZOOKA", "ORIGIN_PULSE", "RAZOR_SHELL", "SCALD", "SPARKLING_ARIA", "SURF", "TECHNO_BLAST_DOUSE", "WATER_PULSE", "WEATHER_BALL_WATER"]
};

let regionTypings = {
    "KANTO": [1-151],
    "JOHTO": [152-251],
    "HOENN": [252-386],
    "SINNOH": [387-493],
    "UNOVA": [494-649],
    "KALOS": [650-721],
    "ALOLA": [722-807],
    "UNKNOWN": [808,809],
    "GALAR": [810-898],
    "HISUI": [899-905],
    "PALDEA": [906-1024],
}


let numberToTypes = {};

// DOM Elements
const elements = {
    pokemonGrid: document.getElementById('pokemonGrid'),
    searchInput: document.getElementById('searchInput'),
	sortBy: document.getElementById('sortBy'),
    filterStatus: document.getElementById('filterStatus'),
    filterFastMove: document.getElementById('filterFastMove'),
    filterChargedMove: document.getElementById('filterChargedMove'),
    filterGender: document.getElementById('filterGender'),
    filterForm: document.getElementById('filterForm'),
    filterCostume: document.getElementById('filterCostume'),
    filterRegion: document.getElementById('filterRegion'),
    loadSampleDataBtn: document.getElementById('loadSampleData'),
    uploadJsonBtn: document.getElementById('uploadJsonBtn'),
    advancedFiltersToggle: document.getElementById('toggleAdvancedFilters'),
    advancedFiltersContainer: document.getElementById('advancedFiltersContainer'),
    cpMin: document.getElementById('cpMin'),
    cpMax: document.getElementById('cpMax'),
    attackMin: document.getElementById('attackMin'),
    attackMax: document.getElementById('attackMax'),
    defenceMin: document.getElementById('defenceMin'),
    defenceMax: document.getElementById('defenceMax'),
    staminaMin: document.getElementById('staminaMin'),
    staminaMax: document.getElementById('staminaMax'),
    selectAllBtn: document.getElementById('selectAllBtn'),
    deselectAllBtn: document.getElementById('deselectAllBtn'),
    selectedCount: document.getElementById('selectedCount'),
    exportSelectedBtn: document.getElementById('exportSelectedBtn'),
    // Stats elements
    totalPokemon: document.getElementById('totalPokemon'),
    uniquePokemon: document.getElementById('uniquePokemon'),
    shinyCount: document.getElementById('shinyCount'),
    shadowCount: document.getElementById('shadowCount'),
    luckyCount: document.getElementById('luckyCount'),
    avgCp: document.getElementById('avgCp'),
    avgIv: document.getElementById('avgIv'),
    // Modal elements
    pokemonModal: document.getElementById('pokemonModal'),
    modalTitle: document.getElementById('modalTitle'),
    modalDetails: document.getElementById('modalDetails'),
    closeModal: document.getElementById('closeModal'),
    closeModalBtn: document.getElementById('closeModalBtn'),
    // Load more button
    loadMoreBtn: document.getElementById('loadMoreBtn'),
    // Radio buttons
    filterNone: document.getElementById('filterNone'),
    filterShiny: document.getElementById('filterShiny'),
    filterLucky: document.getElementById('filterLucky'),
    filterShadow: document.getElementById('filterShadow'),
    filterPurified: document.getElementById('filterPurified'),
    filterHundo: document.getElementById('filterHundo'),
    filterNundo: document.getElementById('filterNundo'),
    filterNickname: document.getElementById('filterNickname')

};

const TYPE_LIST = [
  "Normal", "Fire", "Water", "Electric", "Grass", "Ice",
  "Fighting", "Poison", "Ground", "Flying", "Psychic", "Bug",
  "Rock", "Ghost", "Dragon", "Dark", "Steel", "Fairy"
];

const selectedTypes = new Set();
function renderTypeFilters() {
    const container = document.getElementById('type-filter');
    TYPE_LIST.forEach(type => {
        const span = document.createElement('span');
        span.className = `type-badge type-${type.toLowerCase()}`;
        span.textContent = type;

        // ‚úÖ THIS IS THE CLICK HANDLER
        document.getElementById('clear-type-filters').onclick = () => {
        selectedTypes.clear();
        document.querySelectorAll('#type-filter .type-badge').forEach(badge => {
            badge.classList.remove('selected');
        });
        filterAndSortPokemon();
    };

        span.onclick = () => {
            if (selectedTypes.has(type)) {
                selectedTypes.delete(type);
                span.classList.remove('selected');
            } else {
                selectedTypes.add(type);
                span.classList.add('selected');
            }
            filterAndSortPokemon();
        };

        container.appendChild(span);
    });
}


renderTypeFilters();

// Utility functions

function updateDependentMoveOptions() {
    if (!moveDropdownsLinked) return; // Do nothing if not linked

    const selectedFast = elements.filterFastMove.value;
    const selectedCharged = elements.filterChargedMove.value;

    const fastMoveSet = new Set();
    const chargedMoveSet = new Set();

    for (const id in pokemonData) {
        const p = pokemonData[id];

        const hasFast = !selectedFast || p.mon_move_1 === selectedFast;
        const hasCharged = !selectedCharged || p.mon_move_2 === selectedCharged || p.mon_move_3 === selectedCharged;

        if (hasFast && hasCharged) {
            if (p.mon_move_1) fastMoveSet.add(p.mon_move_1);
            if (p.mon_move_2) chargedMoveSet.add(p.mon_move_2);
            if (p.mon_move_3) chargedMoveSet.add(p.mon_move_3);
        }
    }

    const prevFast = selectedFast;
    const prevCharged = selectedCharged;

    elements.filterFastMove.length = 1;
    for (const move of Array.from(fastMoveSet).sort()) {
        const option = document.createElement('option');
        option.value = move;
        option.textContent = formatMoveName(move);
        elements.filterFastMove.appendChild(option);
    }

    elements.filterChargedMove.length = 1;
    for (const move of Array.from(chargedMoveSet).sort()) {
        const option = document.createElement('option');
        option.value = move;
        option.textContent = formatMoveName(move);
        elements.filterChargedMove.appendChild(option);
    }

    if (fastMoveSet.has(prevFast)) elements.filterFastMove.value = prevFast;
    if (chargedMoveSet.has(prevCharged)) elements.filterChargedMove.value = prevCharged;
}

function updateFastMoveDropdown() {
    const chargedValue = elements.filterChargedMove.value;
    if (!chargedValue) return;

    const fastMoves = new Set();
    for (const id in pokemonData) {
        const p = pokemonData[id];
        if (p.mon_move_2 === chargedValue || p.mon_move_3 === chargedValue) {
            fastMoves.add(p.mon_move_1);
        }
    }

    const prevFast = elements.filterFastMove.value;
    elements.filterFastMove.length = 1;
    for (const move of Array.from(fastMoves).sort()) {
        const option = document.createElement('option');
        option.value = move;
        option.textContent = formatMoveName(move);
        elements.filterFastMove.appendChild(option);
    }
    if (fastMoves.has(prevFast)) elements.filterFastMove.value = prevFast;
}

function updateChargedMoveDropdown() {
    const fastValue = elements.filterFastMove.value;
    if (!fastValue) return;

    const chargedMoves = new Set();
    for (const id in pokemonData) {
        const p = pokemonData[id];
        if (p.mon_move_1 === fastValue) {
            if (p.mon_move_2) chargedMoves.add(p.mon_move_2);
            if (p.mon_move_3) chargedMoves.add(p.mon_move_3);
        }
    }

    const prevCharged = elements.filterChargedMove.value;
    elements.filterChargedMove.length = 1;
    for (const move of Array.from(chargedMoves).sort()) {
        const option = document.createElement('option');
        option.value = move;
        option.textContent = formatMoveName(move);
        elements.filterChargedMove.appendChild(option);
    }
    if (chargedMoves.has(prevCharged)) elements.filterChargedMove.value = prevCharged;
}


function repopulateUnlinkedMoveDropdowns() {
    const fastMoveSet = new Set();
    const chargedMoveSet = new Set();

    for (const id in pokemonData) {
        const p = pokemonData[id];
        if (p.mon_move_1) fastMoveSet.add(p.mon_move_1);
        if (p.mon_move_2) chargedMoveSet.add(p.mon_move_2);
        if (p.mon_move_3) chargedMoveSet.add(p.mon_move_3);
    }

    const prevFast = elements.filterFastMove.value;
    const prevCharged = elements.filterChargedMove.value;

    elements.filterFastMove.length = 1;
    for (const move of Array.from(fastMoveSet).sort()) {
        const option = document.createElement('option');
        option.value = move;
        option.textContent = formatMoveName(move);
        elements.filterFastMove.appendChild(option);
    }

    elements.filterChargedMove.length = 1;
    for (const move of Array.from(chargedMoveSet).sort()) {
        const option = document.createElement('option');
        option.value = move;
        option.textContent = formatMoveName(move);
        elements.filterChargedMove.appendChild(option);
    }

    // Restore selections if still valid
    if (fastMoveSet.has(prevFast)) elements.filterFastMove.value = prevFast;
    if (chargedMoveSet.has(prevCharged)) elements.filterChargedMove.value = prevCharged;
}



function getIVColor(percent) {
    const red = [255, 0, 0];
    const green = [0, 255, 0];
    const mix = percent / 100;
    const blend = (a, b) => Math.round(a + (b - a) * Math.pow(mix,1.5));
    const r = blend(red[0], green[0]);
    const g = blend(red[1], green[1]);
    const b = blend(red[2], green[2]);
    return {
        start: `rgba(${r}, ${g}, ${b}, 0.5)`,
        end: `rgba(${r}, ${g}, ${b}, 0.275)`
    };
}


function getMoveType(moveName) {
  for (const [type, moves] of Object.entries(moveTypings)) {
    if (moves.includes(moveName)) return type.toLowerCase();
  }
  return "unknown";
}

function formatMoveName(move) {
  return move
    .replace(/_FAST$/, "")
    .replace(/_/g, " ")
    .toLowerCase()
    .replace(/\b\w/g, c => c.toUpperCase());
}

function createMoveBadge(moveName) {
  const type = getMoveType(moveName);
  const formatted = formatMoveName(moveName);
  return `<span class="type-badge type-${type}">${formatted}</span>`;
}


function getGenderSymbol(gender) {
    if (gender === 'MALE') return '<span class="gender-male">‚ôÇ</span>';
    if (gender === 'FEMALE') return '<span class="gender-female">‚ôÄ</span>';
    return '<span class="gender-neutral">‚ö™</span>';
}

function calculateIVPercentage(attack, defence, stamina) {
    // IV percentage is calculated as (A + D + S) / 45 * 100
    return ((attack + defence + stamina) / 45 * 100).toFixed(2);
}

const formTypeOverrides = {
    "19_RATTATA_ALOLA": ["DARK","NORMAL"],"19_RATTATA_NORMAL": ["NORMAL"],
    "20_RATICATE_ALOLA": ["DARK","NORMAL"],"20_RATICATE_NORMAL": ["NORMAL"],
    "27_SANDSHREW_ALOLA": ["ICE","STEEL"],"27_SANDSHREW_NORMAL": ["GROUND"],
    "28_SANDSLASH_ALOLA": ["ICE","STEEL"],"28_SANDSLASH_NORMAL": ["GROUND"],
    "37_VULPIX_NORMAL": ["FIRE"], "37_VULPIX_ALOLA": ["ICE"],
    "38_NINETALES_NORMAL": ["FIRE"], "38_NINETALES_ALOLA": ["ICE","FAIRY"],
    "50_DIGLETT_NORMAL": ["GROUND"], "50_DIGLETT_ALOLA": ["GROUND","STEEL"],
    "51_DUGTRIO_NORMAL": ["GROUND"], "51_DUGTRIO_ALOLA": ["GROUND","STEEL"],
    "52_MEOWTH_ALOLA": ["DARK"],"52_MEOWTH_NORMAL": ["NORMAL"],"52_MEOWTH_GALARIAN": ["STEEL"],
    "53_PERSIAN_NORMAL": ["NORMAL"], "53_PERSIAN_ALOLA": ["DARK"],
    "58_GROWLITHE_NORMAL": ["FIRE"], "58_GROWLITHE_HISUIAN": ["FIRE","ROCK"],
    "59_ARCANINE_NORMAL": ["FIRE"], "59_ARCANINE_HISUIAN": ["FIRE","ROCK"],
    "74_GEODUDE_NORMAL": ["ROCK","GROUND"], "74_GEODUDE_ALOLA": ["ROCK","ELECTRIC"],
    "75_GRAVELER_NORMAL": ["ROCK","GROUND"], "75_GRAVELER_ALOLA": ["ROCK","ELECTRIC"],
    "76_GOLEM_NORMAL": ["ROCK","GROUND"], "76_GOLEM_ALOLA": ["ROCK","ELECTRIC"],
    "77_PONYTA_NORMAL": ["FIRE"], "77_PONYTA_GALARIAN": ["PSYCHIC"],
    "78_RAPIDASH_NORMAL": ["FIRE"], "78_RAPIDASH_GALARIAN": ["PSYCHIC","FAIRY"],
    "79_SLOWPOKE_NORMAL": ["WATER","PSYCHIC"], "79_SLOWPOKE_GALARIAN": ["PSYCHIC"],
    "80_SLOWBRO_NORMAL": ["WATER","PSYCHIC"], "80_SLOWBRO_GALARIAN": ["POISON","PSYCHIC"],
    "83_FARFETCHD_NORMAL": ["NORMAL","FLYING"], "83_FARFETCHD_GALARIAN": ["FIGHTING"],
    "88_GRIMER_NORMAL": ["POISON"], "88_GRIMER_ALOLA": ["POISON","DARK"],
    "89_MUK_NORMAL": ["POISON"], "89_MUK_ALOLA": ["POISON","DARK"],
    "100_VOLTORB_NORMAL": ["ELECTRIC"], "100_VOLTORB_HISUIAN": ["ELECTRIC","GRASS"],
    "101_ELECTRODE_NORMAL": ["ELECTRIC"], "101_ELECTRODE_HISUIAN": ["ELECTRIC","GRASS"],
    "103_EXEGGUTOR_NORMAL": ["GRASS","PSYCHIC"], "103_EXEGGUTOR_ALOLA": ["GRASS","DRAGON"],
    "105_MAROWAK_NORMAL": ["GROUND"], "105_MAROWAK_ALOLA": ["FIRE","GHOST"],
    "110_WEEZING_NORMAL": ["POISON"], "110_WEEZING_GALARIAN": ["POISON","FAIRY"],
    "122_MR_MIME_NORMAL": ["PSYCHIC","FAIRY"], "122_MR_MIME_GALARIAN": ["ICE","PSYCHIC"],
    "128_TAUROS_PALDEA_COMBAT": ["FIGHTING"], "128_TAUROS_PALDEA_BLAZE": ["FIGHTING","FIRE"], "128_TAUROS_PALDEA_AQUA": ["FIGHTING","WATER"], "128_TAUROS_NORMAL": ["NORMAL"],
    "144_ARTICUNO_NORMAL": ["ICE","FLYING"], "144_ARTICUNO_GALARIAN": ["PSYCHIC","FLYING"],
    "145_ZAPDOS_NORMAL": ["ELECTRIC","FLYING"], "145_ZAPDOS_GALARIAN": ["FIGHTING","FLYING"],
    "146_MOLTRES_NORMAL": ["FIRE","FLYING"], "146_MOLTRES_GALARIAN": ["DARK","FLYING"],
    "157_TYPHLOSION_NORMAL": ["FIRE"], "157_TYPHLOSION_HISUIAN": ["FIRE","GHOST"],
    "194_WOOPER_NORMAL": ["WATER","GROUND"], "194_WOOPER_PALDEA": ["POISON","GROUND"],
    "199_SLOWKING_NORMAL": ["WATER","PSYCHIC"], "199_SLOWKING_GALARIAN": ["POISON","PSYCHIC"],
    "211_QWILFISH_NORMAL": ["WATER","POISON"], "211_QWILFISH_HISUIAN": ["DARK","POISON"],
    "215_SNEASEL_NORMAL": ["DARK","ICE"], "215_SNEASEL_HISUIAN": ["FIGHTING","POISON"],
    "222_CORSOLA_NORMAL": ["WATER","ROCK"], "222_CORSOLA_GALARIAN": ["GHOST"],
    "263_ZIGZAGOON_NORMAL": ["NORMAL"], "263_ZIGZAGOON_GALARIAN": ["DARK","NORMAL"],
    "264_LINOONE_NORMAL": ["NORMAL"], "264_LINOONE_GALARIAN": ["DARK","NORMAL"],
    "351_CASTFORM_NORMAL": ["NORMAL"],"351_CASTFORM_SNOWY": ["ICE"],"351_CASTFORM_RAINY": ["WATER"],"351_CASTFORM_SUNNY": ["FIRE"],
    "413_WORMADAM_TRASH": ["BUG","STEEL"],"413_WORMADAM_PLANT": ["BUG","GRASS"],"413_WORMADAM_SANDY": ["BUG","GROUND"],
    "479_ROTOM_NORMAL": ["GHOST","ELECTRIC"],"479_ROTOM_FAN": ["FLYING","ELECTRIC"],"479_ROTOM_WASH": ["WATER","ELECTRIC"],"479_ROTOM_FROST": ["ICE","ELECTRIC"],"479_ROTOM_HEAT": ["FIRE","ELECTRIC"],"479_ROTOM_MOW": ["GRASS","ELECTRIC"],
    "503_SAMUROTT_NORMAL": ["WATER"], "503_SAMUROTT_HISUIAN": ["WATER","DARK"],
    "549_LILLIGANT_NORMAL": ["GRASS"], "549_LILLIGANT_HISUIAN": ["GRASS","FIGHTING"],
    "554_DARUMAKA_NORMAL": ["FIRE"], "554_DARUMAKA_GALARIAN": ["ICE"],
    "555_DARMANITAN_STANDARD": ["FIRE"], "555_DARMANITAN_GALARIAN_STANDARD": ["ICE"],
    "562_YAMASK_NORMAL": ["GHOST"], "562_YAMASK_GALARIAN": ["GROUND","GHOST"],
    "570_ZORUA_NORMAL": ["DARK"], "570_ZORUA_HISUIAN": ["NORMAL","GHOST"],
    "571_ZOROARK_NORMAL": ["DARK"], "571_ZOROARK_HISUIAN": ["NORMAL","GHOST"],
    "618_STUNFISK_NORMAL": ["GROUND","ELECTRIC"], "618_STUNFISK_GALARIAN": ["GROUND","STEEL"],
    "628_BRAVIARY_NORMAL": ["NORMAL","FLYING"], "628_BRAVIARY_HISUIAN": ["PSYCHIC","FLYING"],
    "705_SLIGGOO_NORMAL": ["DRAGON"], "705_SLIGGOO_HISUIAN": ["STEEL","DRAGON"],
    /*-----Begin _NORMAL form not implemented---*/
    "26_RAICHU": ["ELECTRIC"], "26_RAICHU_NORMAL": ["ELECTRIC"], "26_RAICHU_ALOLA": ["PSYCHIC","ELECTRIC"],
    "706_GOODRA": ["DRAGON"], "706_GOODRA_HISUIAN": ["STEEL","DRAGON"],
    "713_AVALUGG": ["ICE"], "713_AVALUGG_HISUIAN": ["ICE","ROCK"],
    "724_DECIDUEYE": ["GRASS","GHOST"], "724_DECIDUEYE_HISUIAN": ["GRASS","FIGHTING"],
    /*-----End _NORMAL form not implemented---*/
    "720_HOOPA_CONFINED": ["PSYCHIC","GHOST"],"720_HOOPA_UNBOUND": ["PSYCHIC","DARK"],
    "741_ORICORIO_PAU": ["FLYING","PSYCHIC"],"741_ORICORIO_POMPOM": ["FLYING","ELECTRIC"],"741_ORICORIO_SENSU": ["FLYING","GHOST"],"741_ORICORIO_BAILE": ["FLYING","FIRE"],
    "800_NECROZMA_NORMAL": ["PSYCHIC"],"800_NECROZMA_DUSK_MANE": ["PSYCHIC","STEEL"],"800_NECROZMA_DAWN_WINGS": ["PSYCHIC","GHOST"],"800_NECROZMA_ULTRA": ["PSYCHIC","DRAGON"],
    "888_ZACIAN_HERO": ["FAIRY"],"888_ZACIAN_CROWNED_SWORD": ["FAIRY","STEEL"],
    "889_ZAMAZENTA_HERO": ["FIGHTING"],"889_ZAMAZENTA_CROWNED_SHIELD": ["FIGHTING","STEEL"],

};

const formRegionOverrides = {
    "ALOLA": ["RATTATA_ALOLA","RATICATE_ALOLA","RAICHU_ALOLA","SANDSHREW_ALOLA","SANDSLASH_ALOLA","VULPIX_ALOLA","NINETALES_ALOLA","DIGLETT_ALOLA","DUGTRIO_ALOLA","MEOWTH_ALOLA","PERSIAN_ALOLA","GEODUDE_ALOLA","GRAVELER_ALOLA","GOLEM_ALOLA","GRIMER_ALOLA","MUK_ALOLA","MAROWAK_ALOLA"],
    "GALARIAN": ["MEOWTH_GALARIAN","PONYTA_GALARIAN","RAPIDASH_GALARIAN","SLOWPOKE_GALARIAN","SLOWBRO_GALARIAN","FARFETCHD_GALARIAN","WEEZING_GALARIAN","MR_MIME_GALARIAN","ARTICUNO_GALARIAN","ZAPDOS_GALARIAN","MOLTRES_GALARIAN","SLOWKING_GALARIAN","CORSOLA_GALARIAN","ZIGZAGOON_GALARIAN","LINOONE_GALARIAN","DARUMAKA_GALARIAN","DARMANITAN_GALARIAN","YAMASK_GALARIAN","STUNFISK_GALARIAN"],
    "HISUI": ["GROWLITHE_HISUIAN","ARCANINE_HISUIAN","VOLTORB_HISUIAN","ELECTRODE_HISUIAN","TYPHLOSION_HISUIAN","QWILFISH_HISUIAN","SNEASEL_HISUIAN","SAMUROTT_HISUIAN","LILLIGANT_HISUIAN","ZORUA_HISUIAN","ZOROARK_HISUIAN","BRAVIARY_HISUIAN","SLIGGOO_HISUIAN","GOODRA_HISUIAN","AVALUGG_HISUIAN","DECIDUEYE_HISUIAN"],
    "PALDEA": ["TAUROS_PALDEA_AQUA", "TAUROS_PALDEA_BLAZE", "TAUROS_PALDEA_COMBAT", "WOOPER_PALDEA"]
}



function getPokemonTypes(monNumber, monForm = null, monName = null) {
    if (monForm) {
        const cleanForm = monForm.trim().toUpperCase();
        const key = `${monNumber}_${cleanForm}`;
        console.log("getPokemonTypes() ‚Üí checking key:", key, "‚Üí", formTypeOverrides[key]);
        if (formTypeOverrides[key]) {
            return formTypeOverrides[key];
        }
    } else if (monName) {
        const normalKey = `${monNumber}_${monName.trim().toUpperCase()}_NORMAL`;
        console.log("getPokemonTypes() ‚Üí checking fallback key:", normalKey, "‚Üí", formTypeOverrides[normalKey]);
        if (formTypeOverrides[normalKey]) {
            return formTypeOverrides[normalKey];
        }
    }

    const types = [];
    for (const [type, numbers] of Object.entries(pokeTypings)) {
        if (numbers.includes(monNumber)) {
            types.push(type);
        }
    }
    return types;
}






// function getPokemonTypes(monNumber, monForm = null) {
//     if (monForm) {
//         const key = `${monNumber}_${monForm.toUpperCase()}`;
//         if (formTypeOverrides[key]) {
//             return formTypeOverrides[key];
//         }
//     }

//     const types = [];
//     for (const [type, numbers] of Object.entries(pokeTypings)) {
//         if (numbers.includes(monNumber)) {
//             types.push(type);
//         }
//     }
//     return types;
// }


// Function to build sprite url from pokemon.mon_details
    function buildSpriteUrl(pokemon) {
    const pokeNumber = pokemon.mon_number.toString();
    let spriteUrl = `https://raw.githubusercontent.com/bluecereal127/BetterDex/master/pm${pokeNumber}`;

    let pm_form = pokemon.mon_form || "";
    let formPart = pm_form.substring(pm_form.indexOf('_') + 1);
    let formSuffix = (formPart === "NORMAL") ? "" : formPart;                                                       //if suffix is _NORMAL, set suffix to nothing, otherwise, substring formpart
    
    //---special cases: unown, burmy, wormadam, kyurem, genesect---//
    if(pokemon.mon_name === "UNOWN" || pokemon.mon_name === "BURMY" || pokemon.mon_name === "WORMADAM"){
        spriteUrl += `.f${pm_form}`;                                                                                // Unown, Burmy, Wormadam get full mon_form
        formSuffix = "";
    }
    if(pokemon.mon_name === "KYUREM" || pokemon.mon_name === "GENESECT"){                                           // Genesect and Kyurem get NORMAL
        spriteUrl += `.fNORMAL`;
        formSuffix = "";
    }

    if (formSuffix !== "") spriteUrl += `.f${formSuffix}`;

    let pm_costume = pokemon.mon_costume || "";
    if (pm_costume !== "") spriteUrl += `.c${pm_costume}`;

    if (pokemon.mon_isshiny === 'YES') {
        spriteUrl += `.s`;
    }

    spriteUrl += `.icon.png`;
    return spriteUrl;
}
// Function to create a Pok√©mon card
function createPokemonCard(id, pokemon) {
    const isShiny = pokemon.mon_isshiny === 'YES';
    const isLucky = pokemon.mon_islucky === 'YES';
    const isShadow = pokemon.mon_alignment === 'SHADOW';
    const pokeNumber = pokemon.mon_number.toString();

    // Create Sprite URL 
    let spriteUrl = buildSpriteUrl(pokemon);
    console.log(spriteUrl);

    // Calculate IV percentage
    const attackIV = Number(pokemon.mon_attack) || 0;
    const defenceIV = Number(pokemon.mon_defence) || 0;
    const staminaIV = Number(pokemon.mon_stamina) || 0;
    const ivPercentage = calculateIVPercentage(attackIV, defenceIV, staminaIV);
    
    // Create card element
    const card = document.createElement('div');
    card.className = `pokemon-card ${isShiny ? 'shiny' : ''} ${isLucky ? 'lucky' : ''} ${isShadow ? 'shadow' : ''}`;
    card.dataset.id = id;

    // Tooltip: show nickname if it exists

    let tooltip = "";
    if (pokemon.mon_nickname) {
        tooltip = pokemon.mon_nickname;
    } else if (pokemon.mon_costume) {
        tooltip = pokemon.mon_costume;
    } else if (pokemon.mon_form && !pokemon.mon_form.endsWith("_NORMAL")) {
        tooltip = pokemon.mon_form;
    }

    if (tooltip) {
        card.title = tooltip;
    }

    card.dataset.id = id;
    card.onclick = () => togglePokemonSelection(id, pokemon);
    card.ondblclick = (event) => {
        event.preventDefault();
        showPokemonDetails(id, pokemon);
    };
    

    // Build card content

    const nicknameFilterSelected = document.getElementById("filterNickname").checked;
    const displayName = (nicknameFilterSelected && pokemon.mon_nickname) ? pokemon.mon_nickname : pokemon.mon_name;


    card.innerHTML = `
        <div class="sprite-container">
            <img src="${spriteUrl}" alt="${displayName}" class="sprite" onerror="this.src='https://raw.githubusercontent.com/bluecereal127/BetterDex/master/pm${pokeNumber}.icon.png'">
        </div>
        
        <div class="pokemon-name">
            ${displayName} ${getGenderSymbol(pokemon.mon_gender)}
        </div>
    `;

    //--typings go directly beneath 'mon name--//
    const types = getPokemonTypes(pokemon.mon_number, pokemon.mon_form, pokemon.mon_name);
    const typeHtml = types.map(type => `<span class="type-badge type-${type.toLowerCase()}">${type}</span>`).join('');
    const typeContainer = document.createElement('div');
    typeContainer.classList.add('pokemon-types');
    typeContainer.innerHTML = typeHtml;
    card.appendChild(typeContainer);

        //--finish card html--//
    card.innerHTML += `
    <div class="pokemon-cp">CP ${pokemon.mon_cp}</div>
        
        <div class="stats">
            <div class="stat">
                <div class="stat-value">${attackIV}</div>
                <div class="stat-label">‚öîÔ∏è</div>
            </div>
            <div class="stat">
                <div class="stat-value">${defenceIV}</div>
                <div class="stat-label">üõ°Ô∏è</div>
            </div>
            <div class="stat">
                <div class="stat-value">${staminaIV}</div>
                <div class="stat-label">‚ù§Ô∏è</div>
            </div>
        </div>
    `;
    const moveBadgesContainer = document.createElement('div');
    moveBadgesContainer.classList.add('move-badges');
    moveBadgesContainer.innerHTML = `
        ${createMoveBadge(pokemon.mon_move_1)}
        ${createMoveBadge(pokemon.mon_move_2)}
        ${pokemon.mon_move_3 ? createMoveBadge(pokemon.mon_move_3) : ""}
    `;
    card.appendChild(moveBadgesContainer);

    const moveBadges = `
    <div class="move-badges">
        ${createMoveBadge(pokemon.mon_move_1)}
        ${createMoveBadge(pokemon.mon_move_2)}
        ${pokemon.mon_move_3 ? createMoveBadge(pokemon.mon_move_3) : ""}
    </div>
    `;
    //console.log(`Moves for ${pokemon.mon_name}:`, moveBadges); // üëà Add this

          // <div class="move">${createMoveBadge(pokemon.mon_move_1)}</div>
          // <div class="move">${createMoveBadge(pokemon.mon_move_2)}${" " + createMoveBadge(pokemon.mon_move_3)}</div>

    // Highlight selection
    if (selectedPokemonIds.has(id)) {
        card.classList.add('selected');
    }

    // Style IV background
    const percent = parseFloat(ivPercentage);
    const color = getIVColor(percent);
    card.style.setProperty('--iv-gradient-start', color.start);
    card.style.setProperty('--iv-gradient-end', color.end);
    card.dataset.ivPercent = ivPercentage;

    return card;
}


// Function to toggle Pokemon selection
function togglePokemonSelection(id, pokemon) {
    if (selectedPokemonIds.has(id)) {
        selectedPokemonIds.delete(id);
        document.querySelector(`.pokemon-card[data-id="${id}"]`).classList.remove('selected');
    } else {
        selectedPokemonIds.add(id);
        document.querySelector(`.pokemon-card[data-id="${id}"]`).classList.add('selected');
    }
    
    elements.selectedCount.textContent = `${selectedPokemonIds.size} selected`;
    updateStats();
}

// Function to build sprite url from pokemon.mon_details
function buildSpriteUrl(pokemon) {
    const pokeNumber = pokemon.mon_number.toString();
    let spriteUrl = `https://raw.githubusercontent.com/bluecereal127/BetterDex/master/pm${pokeNumber}`;

    let pm_form = pokemon.mon_form || "";
    let formPart = pm_form.substring(pm_form.indexOf('_') + 1);
    let formSuffix = (formPart === "NORMAL") ? "" : formPart;                                                       //if suffix is _NORMAL, set suffix to nothing, otherwise, substring formpart
    
    //---special cases: unown, burmy, wormadam, kyurem, genesect---//
    if(pokemon.mon_name === "UNOWN" || pokemon.mon_name === "BURMY" || pokemon.mon_name === "WORMADAM"){
        spriteUrl += `.f${pm_form}`;                                                                                // Unown, Burmy, Wormadam get full mon_form
        formSuffix = "";
    }
    if(pokemon.mon_name === "KYUREM" || pokemon.mon_name === "GENESECT"){                                           // Genesect and Kyurem get NORMAL
        spriteUrl += `.fNORMAL`;
        formSuffix = "";
    }
    if (formSuffix !== "") spriteUrl += `.f${formSuffix}`;
    
    let pm_costume = pokemon.mon_costume || "";
    if (pm_costume !== "") spriteUrl += `.c${pm_costume}`;

    if (pokemon.mon_isshiny === 'YES') {
        spriteUrl += `.s`;
    }

    spriteUrl += `.icon.png`;
    return spriteUrl;
}
// Function to show Pokemon details in modal
function showPokemonDetails(id, pokemon) {
    const isShiny = pokemon.mon_isshiny === 'YES';
    const isLucky = pokemon.mon_islucky === 'YES';
    const isShadow = pokemon.mon_alignment === 'SHADOW';
    const isPurified = pokemon.mon_alignment === 'PURIFIED';
    const pokeNumber = pokemon.mon_number.toString();
    
    let spriteUrl = buildSpriteUrl(pokemon);

    // Calculate IV percentage
    const attackIV = Number(pokemon.mon_attack) || 0;
    const defenceIV = Number(pokemon.mon_defence) || 0;
    const staminaIV = Number(pokemon.mon_stamina) || 0;
    const ivPercentage = calculateIVPercentage(attackIV, defenceIV, staminaIV);

    // Get typings
    const types = getPokemonTypes(pokemon.mon_number, pokemon.mon_form);
    const typeHtml = types.map(type => `<span class="type-badge type-${type.toLowerCase()}">${type}</span>`).join('');


    masterUrl = spriteUrl;

    // Build modal content
    elements.modalDetails.innerHTML = `
        <div class="detail-pokemon-sprite">
            <img src="${spriteUrl}" alt="${pokemon.mon_name}" class="sprite" onerror="this.src='https://raw.githubusercontent.com/bluecereal127/BetterDex/master/pm${pokeNumber}.icon.png'">
            <div class="pokemon-number">${pokemon.mon_number}${pokemon.mon_nickname ? `<strong>${pokemon.mon_nickname}</strong>` : `${pokemon.mon_form && !pokemon.mon_form.endsWith('_NORMAL') ? `${pokemon.mon_form.replace((pokemon.mon_name)+'_', ' ')}` : ''}`}</div>
        </div>

        <div class="detail-pokemon-info">
            <div class="detail-section">
                <h3>Basic Information</h3>
                <table class="detail-table">
                    <tr>
                        <th>CP</th>
                        <td>${pokemon.mon_cp}</td>
                    </tr>
                    <tr>
                        <th>HP</th>
                        <td>${pokemon.mon_stamina}</td>
                    </tr>
                    <tr>
                        <th>Type</th>
                        <td><div class="pokemon-types">${typeHtml}</div></td>
                    </tr>
                    <tr>
                        <th>Special Attributes</th>
                        <td>
                            ${isShiny ? '<span class="badge shiny-badge">Shiny</span>' : ''}
                            ${isShadow ? '<span class="badge shadow-badge">Shadow</span>' : ''}
                            ${isPurified ? '<span class="badge">Purified</span>' : ''}
                            ${isLucky ? '<span class="badge lucky-badge">Lucky</span>' : ''}
                        </td>
                    </tr>
                    <tr>
                        <th>Caught Date</th>
                        <td>${pokemon.mon_timestamp || 'Unknown'}</td>
                    </tr>
                </table>
            </div>

            <div class="detail-section">
                <h3>Individual Values (IV)</h3>
                <div class="detail-stats">
                    <div class="detail-stat-box">
                        <div>Attack</div>
                        <div style="font-weight: bold;">${attackIV}/15</div>
                        <div class="stat-bar-container">
                            <div class="stat-bar stat-bar-attack" style="width: ${(attackIV / 15) * 100}%"></div>
                        </div>
                    </div>
                    <div class="detail-stat-box">
                        <div>Defense</div>
                        <div style="font-weight: bold;">${defenceIV}/15</div>
                        <div class="stat-bar-container">
                            <div class="stat-bar stat-bar-defence" style="width: ${(defenceIV / 15) * 100}%"></div>
                        </div>
                    </div>
                    <div class="detail-stat-box">
                        <div>Stamina</div>
                        <div style="font-weight: bold;">${staminaIV}/15</div>
                        <div class="stat-bar-container">
                            <div class="stat-bar stat-bar-stamina" style="width: ${(staminaIV / 15) * 100}%"></div>
                        </div>
                    </div>
                    <div class="detail-stat-box">
                        <div>Total IV</div>
                        <div style="font-weight: bold;">${ivPercentage}%</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${ivPercentage}%"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="detail-section">
                <h3>Moves</h3>
                <div class="detail-moves">
                    <div class="detail-move">
                        <div style="font-size: 12px; color: #777;">Fast Move</div>
                        <div style="font-weight: bold;">${formatMoveName(pokemon.mon_move_1)}</div>
                        <div style="font-size: 12px;">Type: ${pokemon.mon_move_1_type || 'Unknown'}</div>
                    </div>
                    <div class="detail-move">
                        <div style="font-size: 12px; color: #777;">Charged Move</div>
                        <div style="font-weight: bold;">${formatMoveName(pokemon.mon_move_2)}</div>
                        <div style="font-size: 12px;">Type: ${pokemon.mon_move_2_type || 'Unknown'}</div>
                    </div>
                    ${pokemon.mon_move_3 ? `
                    <div class="detail-move">
                        <div style="font-size: 12px; color: #777;">Charged Move 2</div>
                        <div style="font-weight: bold;">${formatMoveName(pokemon.mon_move_3)}</div>
                        <div style="font-size: 12px;">Type: ${pokemon.mon_move_3_type || 'Unknown'}</div>
                    </div>
                    ` : ''}
                </div>
            </div>

            <div class="detail-section">
                <h3>Additional Details</h3>
                <table class="detail-table">
                    <tr>
                        <th>Height</th>
                        <td>${pokemon.mon_height} m</td>
                    </tr>
                    <tr>
                        <th>Weight</th>
                        <td>${pokemon.mon_weight} kg</td>
                    </tr>
                    <tr>
                        <th>Level</th>
                        <td>${pokemon.mon_level || 'Unknown'}</td>
                    </tr>
                    <tr>
                        <th>Form</th>
                        <td>${pokemon.mon_form ? pokemon.mon_form.replace('_', ' ') : 'Normal'}</td>
                    </tr>
                    <tr>
                        <th>Costume</th>
                        <td>${pokemon.mon_costume ? pokemon.mon_costume.replace('_', ' ') : 'None'}</td>
                    </tr>
                </table>
            </div>
        </div>
    `;

    // Show modal
    elements.pokemonModal.classList.remove('hidden');
}

// Place here with other helper functions
function getPokemonRegion(pokemon) {
  const form = pokemon.mon_form;

  for (const [region, forms] of Object.entries(formRegionOverrides)) {
    if (forms.includes(form)) return region;
  }

  const num = Number(pokemon.mon_number);

  if (num >= 1 && num <= 151) return "Kanto";
  if (num >= 152 && num <= 251) return "Johto";
  if (num >= 252 && num <= 386) return "Hoenn";
  if (num >= 387 && num <= 493) return "Sinnoh";
  if (num >= 494 && num <= 649) return "Unova";
  if (num >= 650 && num <= 721) return "Kalos";
  if (num >= 722 && num <= 809) return "Alola";
  if (num >= 810 && num <= 898) return "Galar";
  if (num >= 899 && num <= 905) return "Hisui";
  if (num >= 906 && num <= 1025) return "Paldea";
  if (num >= 807 && num <= 808) return "Undefined";

  return "Unknown";
}

const GEN_TO_REGION = {
  "1": "Kanto",
  "2": "Johto",
  "3": "Hoenn",
  "4": "Sinnoh",
  "5": "Unova",
  "6": "Kalos",
  "7": "Alola",
  "8": "Galar",
  "9": "Paldea"
};

// Master Function to filter and sort Pokemon
function filterAndSortPokemon() {
    filteredPokemonIds = [];

    const searchText = elements.searchInput.value.toLowerCase();
    const sortBy = elements.sortBy.value;
    const filterStatus = elements.filterStatus.value;
    const filterFastMove = elements.filterFastMove.value;
    const filterChargedMove = elements.filterChargedMove.value;
    const filterGender = elements.filterGender.value;
    const filterForm = elements.filterForm.value;
    const filterCostume = elements.filterCostume.value;
    const regionFilter = elements.filterRegion.value;

    const activeSpecialFilters = [];
    if (elements.filterShiny.checked) activeSpecialFilters.push('shiny');
    if (elements.filterLucky.checked) activeSpecialFilters.push('lucky');
    if (elements.filterShadow.checked) activeSpecialFilters.push('shadow');
    if (elements.filterPurified.checked) activeSpecialFilters.push('purified');
    if (elements.filterHundo.checked) activeSpecialFilters.push('hundo');
    if (elements.filterNundo.checked) activeSpecialFilters.push('nundo');
    if (elements.filterNickname.checked) activeSpecialFilters.push('nickname');

    // Advanced filters
    const cpMin = elements.cpMin.value !== '' ? parseInt(elements.cpMin.value) : 0;
    const cpMax = elements.cpMax.value !== '' ? parseInt(elements.cpMax.value) : Infinity;
    const attackMin = elements.attackMin.value !== '' ? parseInt(elements.attackMin.value) : 0;
    const attackMax = elements.attackMax.value !== '' ? parseInt(elements.attackMax.value) : 15;
    const defenceMin = elements.defenceMin.value !== '' ? parseInt(elements.defenceMin.value) : 0;
    const defenceMax = elements.defenceMax.value !== '' ? parseInt(elements.defenceMax.value) : 15;
    const staminaMin = elements.staminaMin.value !== '' ? parseInt(elements.staminaMin.value) : 0;
    const staminaMax = elements.staminaMax.value !== '' ? parseInt(elements.staminaMax.value) : 15;

    // Parse search terms
    let searchTerms = [];
    if (searchText) {
        const andGroups = searchText.split('&').map(group => group.trim());
        searchTerms = andGroups.map(group =>
            group.split(/[,|]/).map(term => term.trim()).filter(term => term)
        );
    }

    for (const id in pokemonData) {
        const pokemon = pokemonData[id];

        // All Forms toggle button
        // If either All Forms or All Costumes is active, show Pok√©mon matching either
        if (window.filterAltFormsOnlyState || window.filterCostumedOnlyState) {
            const isAltForm = window.filterAltFormsOnlyState && pokemon.mon_form && !pokemon.mon_form.endsWith("_NORMAL");
            const isCostumed = window.filterCostumedOnlyState && pokemon.mon_costume && pokemon.mon_costume !== "";

            if (!isAltForm && !isCostumed) continue;
        }


        // Type filter (union of selected types)
        if (selectedTypes.size > 0) {
            const types = getPokemonTypes(pokemon.mon_number, pokemon.mon_form).map(t => t.toLowerCase());
            const matchesType = Array.from(selectedTypes).some(selected => types.includes(selected.toLowerCase()));
            if (!matchesType) continue;
        }

        // Search term filtering
        let matchesSearch = true;
        if (searchTerms.length > 0) {
            matchesSearch = searchTerms.every(orGroup => {
                let hasPositiveMatch = false;
                for (const termRaw of orGroup) {
                    const isNegated = termRaw.startsWith('!');
                    const term = isNegated ? termRaw.slice(1) : termRaw;
                    let matched = false;

                    const genMatch = term.toLowerCase().match(/^gen(\d)$/);
                    if (genMatch) {
                        const targetRegion = GEN_TO_REGION[genMatch[1]];
                        matched = getPokemonRegion(pokemon).toLowerCase() === targetRegion.toLowerCase();
                    } else if (/^\d+(-\d+)?$/.test(term)) {
                        if (term.includes('-')) {
                            const [min, max] = term.split('-').map(Number);
                            matched = pokemon.mon_number >= min && pokemon.mon_number <= max;
                        } else {
                            matched = pokemon.mon_number === parseInt(term);
                        }
                    } else {
                        const termLower = term.toLowerCase();
                        const monName = pokemon.mon_name.toLowerCase();
                        const monNickname = (pokemon.mon_nickname || "").toLowerCase();

                        if (term.startsWith('"') && term.endsWith('"')) {
                            const exact = termLower.slice(1, -1);
                            matched = monName === exact || monNickname === exact;
                        } else {
                            matched = monName.includes(termLower) || monNickname.includes(termLower);
                        }
                    }

                    if (isNegated && matched) return false;
                    if (!isNegated && matched) hasPositiveMatch = true;
                }
                return hasPositiveMatch || orGroup.every(term => term.startsWith('!'));
            });

            if (!matchesSearch) continue;
        }

        // Status dropdown
        if (filterStatus === 'shiny' && pokemon.mon_isshiny !== 'YES') continue;
        if (filterStatus === 'shadow' && pokemon.mon_alignment !== 'SHADOW') continue;
        if (filterStatus === 'lucky' && pokemon.mon_islucky !== 'YES') continue;

        // Special checkboxes
        if (activeSpecialFilters.length > 0) {
            const totalIV = (parseInt(pokemon.mon_attack) || 0) + (parseInt(pokemon.mon_defence) || 0) + (parseInt(pokemon.mon_stamina) || 0);
            const matchesAny =
                (activeSpecialFilters.includes('shiny') && pokemon.mon_isshiny === 'YES') ||
                (activeSpecialFilters.includes('lucky') && pokemon.mon_islucky === 'YES') ||
                (activeSpecialFilters.includes('shadow') && pokemon.mon_alignment === 'SHADOW') ||
                (activeSpecialFilters.includes('purified') && pokemon.mon_alignment === 'PURIFIED') ||
                (activeSpecialFilters.includes('hundo') && totalIV === 45) ||
                (activeSpecialFilters.includes('nundo') && totalIV === 0) ||
                (activeSpecialFilters.includes('nickname') && pokemon.mon_nickname);

            if (!matchesAny) continue;
        }

        // Move filter
        // Move filters (Fast and Charged)
        if (filterFastMove && pokemon.mon_move_1 !== filterFastMove) {
            continue;
        }

        if (filterChargedMove &&
            pokemon.mon_move_2 !== filterChargedMove &&
            pokemon.mon_move_3 !== filterChargedMove) {
            continue;
        }


        // Gender, Form, Costume
        if (filterGender && pokemon.mon_gender !== filterGender) continue;
        if (filterForm && pokemon.mon_form !== filterForm) continue;
        if (filterCostume && pokemon.mon_costume !== filterCostume) continue;

        // Region
        if (regionFilter && getPokemonRegion(pokemon) !== regionFilter) continue;

        // CP range
        const cp = parseInt(pokemon.mon_cp);
        if (cp < cpMin || cp > cpMax) continue;

        // IV ranges
        const attackIV = Number(pokemon.mon_attack) || 0;
        const defenceIV = Number(pokemon.mon_defence) || 0;
        const staminaIV = Number(pokemon.mon_stamina) || 0;
        if (attackIV < attackMin || attackIV > attackMax) continue;
        if (defenceIV < defenceMin || defenceIV > defenceMax) continue;
        if (staminaIV < staminaMin || staminaIV > staminaMax) continue;

        filteredPokemonIds.push(id);
    }

    // Sorting
    filteredPokemonIds.sort((a, b) => {
        const pokemonA = pokemonData[a];
        const pokemonB = pokemonData[b];

        switch (sortBy) {
            case 'number':  return parseInt(pokemonA.mon_number) - parseInt(pokemonB.mon_number);
            case 'cp':      return parseInt(pokemonB.mon_cp) - parseInt(pokemonA.mon_cp);
            case 'name':    return pokemonA.mon_name.localeCompare(pokemonB.mon_name);
            case 'attack':  return parseInt(pokemonB.mon_attack) - parseInt(pokemonA.mon_attack);
            case 'defence': return parseInt(pokemonB.mon_defence) - parseInt(pokemonA.mon_defence);
            case 'stamina': return parseInt(pokemonB.mon_stamina) - parseInt(pokemonA.mon_stamina);
            default: return 0;
        }
    });

    displayPokemon(true);
    updateStats();
}


// Function to display Pokemon
function displayPokemon(reset = false) {
    if (reset) {
        elements.pokemonGrid.innerHTML = '';
        currentlyDisplayed = 0;
    }
    
    const remaining = filteredPokemonIds.length - currentlyDisplayed;
    const toDisplay = Math.min(displayLimit, remaining);
    
    const displayIds = filteredPokemonIds.slice(currentlyDisplayed, currentlyDisplayed + toDisplay);
    
    for (const id of displayIds) {
        const pokemon = pokemonData[id];
        const card = createPokemonCard(id, pokemon);
        elements.pokemonGrid.appendChild(card);
    }
    
    currentlyDisplayed += toDisplay;
    elements.loadMoreBtn.classList.toggle('hidden', currentlyDisplayed >= filteredPokemonIds.length);
    
    if (filteredPokemonIds.length === 0) {
        elements.pokemonGrid.innerHTML = '<div style="grid-column: 1 / -1; text-align: center; padding: 50px; color: #777;">No Pok√©mon found matching your filters.</div>';
    }
}

// Function to populate dropdowns
function populateDropdowns() {
    // Clear old options
    while (elements.filterFastMove.options.length > 1) {
        elements.filterFastMove.remove(1);
    }
    while (elements.filterChargedMove.options.length > 1) {
        elements.filterChargedMove.remove(1);
    }

    // Collect moves
    const fastMoveSet = new Set();
    const chargedMoveSet = new Set();

    for (const id in pokemonData) {
        const p = pokemonData[id];
        if (p.mon_move_1) fastMoveSet.add(p.mon_move_1);
        if (p.mon_move_2) chargedMoveSet.add(p.mon_move_2);
        if (p.mon_move_3) chargedMoveSet.add(p.mon_move_3);
    }

    // Populate Fast Moves
    for (const move of Array.from(fastMoveSet).sort()) {
        const option = document.createElement('option');
        option.value = move;
        option.textContent = formatMoveName(move);
        elements.filterFastMove.appendChild(option);
    }

    // Populate Charged Moves
    for (const move of Array.from(chargedMoveSet).sort()) {
        const option = document.createElement('option');
        option.value = move;
        option.textContent = formatMoveName(move);
        elements.filterChargedMove.appendChild(option);
    }

    
    while (elements.filterForm.options.length > 1) {
        elements.filterForm.remove(1);
    }
    
    while (elements.filterCostume.options.length > 1) {
        elements.filterCostume.remove(1);
    }
    
    // Add move options

    
    // Add form options
    for (const form of Array.from(allForms).sort()) {
        if (form.endsWith('_NORMAL') || form.endsWith('_STANDARD')) continue;
        const option = document.createElement('option');
        option.value = form;
        option.textContent = form ? form.replace('_', ' ') : 'Normal';
        elements.filterForm.appendChild(option);
    }
    
    // Add costume options
    for (const costume of Array.from(allCostumes).sort()) {
        if (!costume) continue;
        const option = document.createElement('option');
        option.value = costume;
        option.textContent = costume.replace('_', ' ');
        elements.filterCostume.appendChild(option);
    }
    updateDependentMoveOptions();

}

// Function to update stats
function updateStats() {
    const useSelected = selectedPokemonIds.size > 0;
    const isFiltered = !useSelected && filteredPokemonIds.length < Object.keys(pokemonData).length;
    const statsContainer = document.getElementById("statsContainer");
    statsContainer.classList.remove("selected-mode", "filtered-mode");

    if (useSelected) {
        statsContainer.classList.add("selected-mode");
    } else if (isFiltered) {
        statsContainer.classList.add("filtered-mode");
    }

    const targetIds = useSelected ? Array.from(selectedPokemonIds) : filteredPokemonIds;
    const labelText = useSelected ? ' (Selected)' : '';



    const suffixIds = [
      "totalStatLabelSuffix",
      "uniqueStatLabelSuffix",
      "shinyStatLabelSuffix",
      "shadowStatLabelSuffix",
      "luckyStatLabelSuffix",
      "cpStatLabelSuffix",
      "ivStatLabelSuffix"
    ];

    suffixIds.forEach(id => {
      const el = document.getElementById(id);
      if (el) el.textContent = labelText;
    });




    if (!targetIds || targetIds.length === 0) {
        elements.totalPokemon.textContent = 0;
        elements.uniquePokemon.textContent = 0;
        elements.shinyCount.textContent = 0;
        elements.shadowCount.textContent = 0;
        elements.luckyCount.textContent = 0;
        elements.avgCp.textContent = 0;
        elements.avgIv.textContent = '0%';
        return;
    }

    const uniqueSpecies = new Set();
    let shinyCount = 0;
    let shadowCount = 0;
    let luckyCount = 0;
    let totalCp = 0;
    let totalIv = 0;

    for (const id of targetIds) {
        const pokemon = pokemonData[id];
        if (!pokemon) continue;

        uniqueSpecies.add(pokemon.mon_number);
        if (pokemon.mon_isshiny === 'YES') shinyCount++;
        if (pokemon.mon_alignment === 'SHADOW') shadowCount++;
        if (pokemon.mon_islucky === 'YES') luckyCount++;

        totalCp += parseInt(pokemon.mon_cp) || 0;

        const attackIV = Number(pokemon.mon_attack) || 0;
        const defenceIV = Number(pokemon.mon_defence) || 0;
        const staminaIV = Number(pokemon.mon_stamina) || 0;
        totalIv += (attackIV + defenceIV + staminaIV) / 45;
    }

    elements.totalPokemon.textContent = targetIds.length;
    elements.uniquePokemon.textContent = uniqueSpecies.size;
    elements.shinyCount.textContent = shinyCount;
    elements.shadowCount.textContent = shadowCount;
    elements.luckyCount.textContent = luckyCount;
    elements.avgCp.textContent = Math.round(totalCp / targetIds.length);
    elements.avgIv.textContent = (totalIv / targetIds.length * 100).toFixed(2) + '%';
}





// Function to export selected pokemon to JSON
function exportSelectedPokemon() {
    if (selectedPokemonIds.size === 0) {
        alert('No Pok√©mon selected. Please select at least one Pok√©mon to export.');
        return;
    }
    
    const selectedPokemon = {};
    for (const id of selectedPokemonIds) {
        selectedPokemon[id] = pokemonData[id];
    }
    
    const jsonString = JSON.stringify(selectedPokemon, null, 2);
    const blob = new Blob([jsonString], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    
    const a = document.createElement('a');
    a.href = url;
    a.download = 'selected_pokemon.json';
    document.body.appendChild(a);
    a.click();
    
    setTimeout(() => {
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }, 100);
}

// Function to load sample data
function loadSampleData() {
    const sampleData = {
  "17673140651742863373": {
    "mon_isshiny": "NO",
    "mon_islucky": "NO",
    "mon_weight": 55.13714599609375,
    "mon_move_1": "CHARGE_BEAM_FAST",
    "mon_height": 1.4637632369995117,
    "mon_gender": "GENDERLESS",
    "mon_form": "ZAPDOS_NORMAL",
    "mon_stamina": 14,
    "mon_attack": 10,
    "mon_name": "ZAPDOS",
    "mon_move_2": "DRILL_PECK",
    "mon_cp": 2448,
    "mon_number": 145,
    "mon_defence": 12,
    "mon_weather_boost": "WINDY"
  },
  "7363298117727603579": {
    "mon_isshiny": "NO",
    "mon_islucky": "NO",
    "mon_weight": 42.5558967590332,
    "mon_move_1": "CHARGE_BEAM_FAST",
    "mon_height": 1.391097903251648,
    "mon_gender": "GENDERLESS",
    "mon_alignment": "SHADOW",
    "mon_stamina": 8,
    "mon_attack": 15,
    "mon_name": "ZAPDOS",
    "mon_move_2": "ANCIENT_POWER",
    "mon_cp": 776,
    "mon_number": 145,
    "mon_defence": 12
  },
  "15465708952440652589": {
    "mon_isshiny": "NO",
    "mon_islucky": "NO",
    "mon_weight": 63.76577377319336,
    "mon_move_1": "CHARGE_BEAM_FAST",
    "mon_height": 1.8745477199554443,
    "mon_gender": "GENDERLESS",
    "mon_alignment": "SHADOW",
    "mon_stamina": 14,
    "mon_attack": 6,
    "mon_name": "ZAPDOS",
    "mon_move_2": "THUNDERBOLT",
    "mon_cp": 757,
    "mon_number": 145,
    "mon_defence": 10
  },
  "10750833196742291976": {
    "mon_isshiny": "NO",
    "mon_islucky": "NO",
    "mon_weight": 56.9967155456543,
    "mon_move_1": "CHARGE_BEAM_FAST",
    "mon_height": 1.6501779556274414,
    "mon_gender": "GENDERLESS",
    "mon_form": "ZAPDOS_NORMAL",
    "mon_alignment": "SHADOW",
    "mon_stamina": 11,
    "mon_attack": 15,
    "mon_name": "ZAPDOS",
    "mon_move_2": "FRUSTRATION",
    "mon_cp": 1982,
    "mon_number": 145,
    "mon_defence": 12
  },
    "8159554756498074688" : {
    "mon_isshiny" : "NO",
    "mon_islucky" : "NO",
    "mon_weight" : 35.862403869628906,
    "mon_move_1" : "SPARK_FAST",
    "mon_height" : 0.86764609813690186,
    "mon_gender" : "MALE",
    "mon_form" : "RAICHU_ALOLA",
    "mon_stamina" : 15,
    "mon_attack" : 11,
    "mon_name" : "RAICHU",
    "mon_move_2" : "WILD_CHARGE",
    "mon_cp" : 947,
    "mon_number" : 26,
    "mon_defence" : 10,
    },
    "14551503511936860197": {
    "mon_isshiny": "NO",
    "mon_islucky": "NO",
    "mon_weight": 30.857364654541016,
    "mon_move_1": "COUNTER_FAST",
    "mon_height": 1.2964884042739868,
    "mon_gender": "GENDERLESS",
    "mon_form": "ZAPDOS_GALARIAN",
    "mon_stamina": 13,
    "mon_attack": 8,
    "mon_name": "ZAPDOS",
    "mon_move_2": "BRAVE_BIRD",
    "mon_cp": 355,
    "mon_number": 145,
    "mon_defence": 10
  },
  "717968478338063915": {
    "mon_isshiny": "NO",
    "mon_islucky": "NO",
    "mon_weight": 72.58869934082031,
    "mon_move_1": "COUNTER_FAST",
    "mon_height": 1.7578277587890625,
    "mon_gender": "GENDERLESS",
    "mon_form": "ZAPDOS_GALARIAN",
    "mon_stamina": 6,
    "mon_attack": 7,
    "mon_name": "ZAPDOS",
    "mon_move_2": "ANCIENT_POWER",
    "mon_cp": 743,
    "mon_number": 145,
    "mon_defence": 6,
    "mon_weather_boost": "WINDY"
  },
  "6452236330306084149": {
    "mon_isshiny": "NO",
    "mon_islucky": "NO",
    "mon_weight": 63.82428741455078,
    "mon_move_1": "CHARGE_BEAM_FAST",
    "mon_height": 1.7502485513687134,
    "mon_gender": "GENDERLESS",
    "mon_form": "ZAPDOS_NORMAL",
    "mon_alignment": "SHADOW",
    "mon_stamina": 15,
    "mon_attack": 7,
    "mon_name": "ZAPDOS",
    "mon_move_2": "ZAP_CANNON",
    "mon_cp": 2431,
    "mon_number": 145,
    "mon_defence": 13,
    "mon_weather_boost": "WINDY"
  },
  "11712407021149250652": {
    "mon_isshiny": "NO",
    "mon_islucky": "NO",
    "mon_weight": 50.71421813964844,
    "mon_move_1": "THUNDER_SHOCK_FAST",
    "mon_height": 1.4158815145492554,
    "mon_gender": "GENDERLESS",
    "mon_form": "ZAPDOS_NORMAL",
    "mon_stamina": 11,
    "mon_attack": 13,
    "mon_name": "ZAPDOS",
    "mon_move_2": "THUNDERBOLT",
    "mon_cp": 2446,
    "mon_number": 145,
    "mon_defence": 10,
    "mon_weather_boost": "WINDY"
  },
  "1248576179712333980": {
    "mon_isshiny": "NO",
    "mon_islucky": "NO",
    "mon_weight": 25.040462493896484,
    "mon_move_1": "CHARGE_BEAM_FAST",
    "mon_height": 1.2822333574295044,
    "mon_gender": "GENDERLESS",
    "mon_form": "ZAPDOS_NORMAL",
    "mon_stamina": 11,
    "mon_attack": 13,
    "mon_name": "ZAPDOS",
    "mon_move_2": "THUNDER",
    "mon_cp": 2471,
    "mon_number": 145,
    "mon_defence": 14
  },
  "4387782779858585036": {
    "mon_isshiny": "NO",
    "mon_islucky": "NO",
    "mon_weight": 30.830202102661133,
    "mon_move_1": "CHARGE_BEAM_FAST",
    "mon_height": 1.3531192541122437,
    "mon_gender": "GENDERLESS",
    "mon_form": "ZAPDOS_NORMAL",
    "mon_stamina": 10,
    "mon_attack": 15,
    "mon_name": "ZAPDOS",
    "mon_move_2": "ZAP_CANNON",
    "mon_cp": 1967,
    "mon_number": 145,
    "mon_defence": 10
  },
  "2640376050793073366": {
    "mon_isshiny": "NO",
    "mon_islucky": "NO",
    "mon_weight": 34.159698486328125,
    "mon_move_1": "CHARGE_BEAM_FAST",
    "mon_height": 1.3401193618774414,
    "mon_gender": "GENDERLESS",
    "mon_form": "ZAPDOS_NORMAL",
    "mon_alignment": "SHADOW",
    "mon_stamina": 6,
    "mon_attack": 8,
    "mon_name": "ZAPDOS",
    "mon_move_2": "FRUSTRATION",
    "mon_cp": 2367,
    "mon_number": 145,
    "mon_defence": 9,
    "mon_weather_boost": "WINDY"
  }
};
    
    loadPokemonData(sampleData);
}

// Function to process uploaded JSON file
function handleFileUpload(event) {
    const fileInput = event.target;
    const file = fileInput.files[0];
    
    if (!file) {
        return;
    }
    
    const reader = new FileReader();
    
    reader.onload = function(e) {
        try {
            const data = JSON.parse(e.target.result);
            loadPokemonData(data);
        } catch (error) {
            alert('Error parsing JSON file: ' + error.message);
        }
    };
    
    reader.readAsText(file);
    fileInput.value = '';
}

// Function to load Pokemon data
function loadPokemonData(data) {
    pokemonData = data;
    selectedPokemonIds.clear();
    elements.selectedCount.textContent = '0 selected';
    
    allMoves = new Set();
    allForms = new Set();
    allCostumes = new Set();
    
    for (const id in pokemonData) {
        const pokemon = pokemonData[id];
        
        if (pokemon.mon_move_1) allMoves.add(pokemon.mon_move_1);
        if (pokemon.mon_move_2) allMoves.add(pokemon.mon_move_2);
        if (pokemon.mon_move_3) allMoves.add(pokemon.mon_move_3);
        if (pokemon.mon_form) allForms.add(pokemon.mon_form);
        if (pokemon.mon_costume) allCostumes.add(pokemon.mon_costume);
    }
    
    populateDropdowns();
    updateStats();
    filterAndSortPokemon();
}

// Function to select all visible Pokemon
function selectAllVisible() {
    for (const id of filteredPokemonIds) {
        selectedPokemonIds.add(id);
        const card = document.querySelector(`.pokemon-card[data-id="${id}"]`);
        if (card) {
            card.classList.add('selected');
        }
    }
    
    elements.selectedCount.textContent = `${selectedPokemonIds.size} selected`;
}

// Function to deselect all Pokemon
function deselectAll() {
    selectedPokemonIds.clear();
    const selectedCards = document.querySelectorAll('.pokemon-card.selected');
    for (const card of selectedCards) {
        card.classList.remove('selected');
    }
    
    elements.selectedCount.textContent = '0 selected';
}

// Event listeners
function setupEventListeners() {
    // Filter changes
    elements.searchInput.addEventListener('input', filterAndSortPokemon);
    elements.sortBy.addEventListener('change', filterAndSortPokemon);
    elements.filterStatus.addEventListener('change', filterAndSortPokemon);
    elements.filterGender.addEventListener('change', filterAndSortPokemon);
    elements.filterForm.addEventListener('change', filterAndSortPokemon);
    elements.filterCostume.addEventListener('change', filterAndSortPokemon);
    elements.filterRegion.addEventListener('change', filterAndSortPokemon);
    
    // Move filters
    elements.filterFastMove.addEventListener('change', filterAndSortPokemon);
    elements.filterChargedMove.addEventListener('change', filterAndSortPokemon);
    elements.filterFastMove.addEventListener('change', () => {
        updateDependentMoveOptions();
        filterAndSortPokemon();
    });

    elements.filterChargedMove.addEventListener('change', () => {
        updateDependentMoveOptions();
        filterAndSortPokemon();
    });

    document.getElementById('toggleMoveLink').addEventListener('click', () => {
        moveDropdownsLinked = !moveDropdownsLinked;

        const toggleBtn = document.getElementById('toggleMoveLink');
        toggleBtn.textContent = moveDropdownsLinked ? 'üîÉ' : 'üîÄ';

        if (moveDropdownsLinked) {
            // Re-filter based on current selection
            updateDependentMoveOptions();
        } else {
            // Repopulate both dropdowns fully
            repopulateUnlinkedMoveDropdowns();
        }

        filterAndSortPokemon();
    });



    // Radio button filters
    elements.filterShiny.addEventListener('change', filterAndSortPokemon);
    elements.filterLucky.addEventListener('change', filterAndSortPokemon);
    elements.filterShadow.addEventListener('change', filterAndSortPokemon);
    elements.filterPurified.addEventListener('change', filterAndSortPokemon);
    elements.filterHundo.addEventListener('change', filterAndSortPokemon);
    elements.filterNundo.addEventListener('change', filterAndSortPokemon);
    elements.filterNickname.addEventListener('change', filterAndSortPokemon);
    elements.filterNone.addEventListener('change', filterAndSortPokemon);
    
    document.addEventListener("DOMContentLoaded", () => {
    document.getElementById("filterForm").addEventListener("change", () => {
        document.getElementById("filterAltFormsOnly").checked = false;
        filterAndSortPokemon();
    });

    document.getElementById("filterCostume").addEventListener("change", () => {
        document.getElementById("filterCostumedOnly").checked = false;
        filterAndSortPokemon();
    });
    });

    
    // Advanced filters toggle
    elements.advancedFiltersToggle.addEventListener('change', function() {
        elements.advancedFiltersContainer.classList.toggle('hidden', !this.checked);
    });
    
    // Advanced filter changes
    elements.cpMin.addEventListener('input', filterAndSortPokemon);
    elements.cpMax.addEventListener('input', filterAndSortPokemon);
    elements.attackMin.addEventListener('input', filterAndSortPokemon);
    elements.attackMax.addEventListener('input', filterAndSortPokemon);
    elements.defenceMin.addEventListener('input', filterAndSortPokemon);
    elements.defenceMax.addEventListener('input', filterAndSortPokemon);
    elements.staminaMin.addEventListener('input', filterAndSortPokemon);
    elements.staminaMax.addEventListener('input', filterAndSortPokemon);

    
    // Selection tools
    elements.selectAllBtn.addEventListener('click', selectAllVisible);
    elements.deselectAllBtn.addEventListener('click', deselectAll);
    
    // Load more button
    elements.loadMoreBtn.addEventListener('click', function() {
        displayPokemon(false);
    });
    
    window.addEventListener('scroll', function () {
        if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight - 100) {
            displayPokemon(false);
        }
    });
    
    // Upload JSON file
    elements.uploadJsonBtn.addEventListener('click', function() {
        const fileInput = document.createElement('input');
        fileInput.type = 'file';
        fileInput.accept = '.json';
        fileInput.onchange = handleFileUpload;
        fileInput.click();
    });
    
    // Load sample data
    elements.loadSampleDataBtn.addEventListener('click', loadSampleData);
    
    // Export selected
    elements.exportSelectedBtn.addEventListener('click', exportSelectedPokemon);
    
    // Modal close
    elements.closeModal.addEventListener('click', function() {
        elements.pokemonModal.classList.add('hidden');
    });
    
    elements.closeModalBtn.addEventListener('click', function() {
        elements.pokemonModal.classList.add('hidden');
    });
    // Ensure all <select> dropdowns trigger filtering and stats update
    document.querySelectorAll('select').forEach(select => {
        select.addEventListener('change', filterAndSortPokemon);
    });

    
    // Close modal when clicking outside
    elements.pokemonModal.addEventListener('click', function(event) {
        if (event.target === elements.pokemonModal) {
            elements.pokemonModal.classList.add('hidden');
        }
    });
    
    // Keyboard events
    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape' && !elements.pokemonModal.classList.contains('hidden')) {
            elements.pokemonModal.classList.add('hidden');
        }
    });
    
    document.querySelectorAll('.alpha-nav li').forEach(li => {
        li.addEventListener('click', () => {
            const letter = li.dataset.letter.toUpperCase();
            const targetCard = Array.from(document.querySelectorAll('.pokemon-card')).find(card => {
                const name = card.querySelector('.pokemon-name')?.textContent?.trim()?.toUpperCase();
                return name?.startsWith(letter);
            });

            if (targetCard) {
                targetCard.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        });
    });
}

// Initialize the app
function init() {
    setupEventListeners();
    
    // Add file reader element for uploads (hidden)
    const fileReader = document.createElement('input');
    fileReader.type = 'file';
    fileReader.id = 'fileInput';
    fileReader.accept = '.json';
    fileReader.style.display = 'none';
    document.body.appendChild(fileReader);
    
    // Show initial message
    elements.pokemonGrid.innerHTML = `
        <div style="grid-column: 1 / -1; text-align: center; padding: 50px; color: #777;">
            <p>Welcome to the Pok√©mon GO Collection Viewer!</p>
            <p>To get started, click "Load Sample Data" or "Upload JSON File".</p>
        </div>
    `;
}

// Clear all special filters when None is pressed //
function clearSpecialFilters() {
    const filters = [
        'filterShiny',
        'filterLucky',
        'filterShadow',
        'filterPurified',
        'filterHundo',
        'filterNundo',
        'filterNickname'
    ];

    filters.forEach(id => {
        const el = document.getElementById(id);
        if (el) el.checked = false;
    });

    // Also clear All Forms and All Costumes buttons
    const altFormsBtn = document.getElementById('filterAltFormsOnly');
    const costumedBtn = document.getElementById('filterCostumedOnly');

    if (altFormsBtn) {
        altFormsBtn.classList.remove('active');
        window.filterAltFormsOnlyState = false;
    }

    if (costumedBtn) {
        costumedBtn.classList.remove('active');
        window.filterCostumedOnlyState = false;
    }

    filterAndSortPokemon();
}


const dropdowns = document.querySelectorAll('select');
dropdowns.forEach(select => {
    select.addEventListener('change', () => {
        filterAndSortPokemon(); // includes updateStats()
    });
});



// Start the app when DOM is loaded
document.addEventListener('DOMContentLoaded', init);
</script>

<div id="searchHelpModal" class="modal-overlay hidden">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Search Tips</h2>
      <button class="close-modal" onclick="closeSearchHelpModal()">√ó</button>
    </div>
    <div class="modal-body">
      <ul style="line-height: 1.8;">
        <li><strong>Name Match:</strong> <code>pikachu</code> ‚Üí matches names or nicknames containing "pikachu"</li>
        <li><strong>Exact Match:</strong> <code>"mewtwo"</code> ‚Üí matches exactly "mewtwo"</li>
        <li><strong>Number:</strong> <code>150</code> ‚Üí matches Pok√©dex #150</li>
        <li><strong>Range:</strong> <code>1-151</code> ‚Üí matches Gen 1 Pok√©mon</li>
        <li><strong>Multiple:</strong> <code>pikachu,eevee</code> ‚Üí OR match for name or nickname</li>
        <li><strong>Negative Match:</strong> <code>!rattata</code> ‚Üí excludes matches</li>
        <li><strong>AND:</strong> <code>electric & shiny</code> ‚Üí must match both</li>
        <li><strong>Generation:</strong> <code>gen1</code> or <code>gen3</code> ‚Üí by region</li>
        <li><strong>Hover:</strong> <code>hover over a 'mons card for more info</li>
      </ul>
    </div>
    <div class="modal-footer">
      <button onclick="closeSearchHelpModal()">Close</button>
    </div>
  </div>
</div>
</body>

</html>